<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Training Live Monitor - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #0a0e27;
            color: #e0e0e0;
            padding: 15px;
            font-size: 13px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #00ff88;
            font-size: 2em;
            text-shadow: 0 0 10px rgba(0,255,136,0.5);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .panel {
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1424 100%);
            border: 1px solid #2a3f5f;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .panel h2 {
            color: #00d9ff;
            font-size: 1.1em;
            margin-bottom: 12px;
            border-bottom: 2px solid #00d9ff;
            padding-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #1a2332;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #888;
            font-weight: 600;
        }

        .metric-value {
            color: #fff;
            font-weight: bold;
            font-family: 'Consolas', monospace;
        }

        .status-training { color: #00ff00; }
        .status-idle { color: #888; }
        .status-crashed { color: #ff4444; }
        .status-completed { color: #00d9ff; }

        .progress-container {
            width: 100%;
            height: 24px;
            background: #0a1628;
            border-radius: 12px;
            overflow: hidden;
            margin: 8px 0;
            border: 1px solid #2a3f5f;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00d9ff);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 11px;
        }

        .gpu-gauge {
            position: relative;
            height: 20px;
            background: #0a1628;
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
            border: 1px solid #2a3f5f;
        }

        .gpu-gauge-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .gauge-temp { background: linear-gradient(90deg, #00ff88, #ffaa00); }
        .gauge-util { background: linear-gradient(90deg, #00d9ff, #0088ff); }
        .gauge-mem { background: linear-gradient(90deg, #ff00ff, #ff0088); }
        .gauge-power { background: linear-gradient(90deg, #ffff00, #ff8800); }

        .gauge-label {
            position: absolute;
            top: 0;
            left: 8px;
            right: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            font-size: 11px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 3px #000;
            z-index: 1;
        }

        .sample-box {
            background: #0f1424;
            border: 1px solid #2a3f5f;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
        }

        .sample-box h3 {
            color: #00ff88;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .sample-box pre {
            background: #0a0e1a;
            padding: 12px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9em;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #1a2332;
        }

        .match-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .match-yes {
            background: #00ff88;
            color: #000;
        }

        .match-no {
            background: #ff4444;
            color: #fff;
        }

        .success {
            color: #00ff88;
            font-weight: bold;
        }

        .danger {
            color: #ff4444;
            font-weight: bold;
        }

        .accuracy-big {
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0,255,136,0.5);
        }

        .value-big {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0,255,136,0.6);
            letter-spacing: 2px;
        }

        .error-panel {
            background: linear-gradient(135deg, #3a1a1a 0%, #241414 100%);
            border: 2px solid #ff0000;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .error-panel h2 {
            color: #ff6666;
            border-bottom-color: #ff0000;
        }

        .refresh-indicator {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.8);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            border: 1px solid #00ff88;
            z-index: 1000;
        }

        .files-indicator {
            position: fixed;
            top: 55px;
            right: 15px;
            background: rgba(0,0,0,0.8);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            border: 1px solid #00d9ff;
            z-index: 1000;
            cursor: pointer;
        }

        .files-indicator:hover {
            background: rgba(0,217,255,0.2);
        }

        .files-badge {
            background: #00d9ff;
            color: #000;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            margin-left: 8px;
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .mini-chart {
            height: 60px;
            background: #0a1628;
            border: 1px solid #2a3f5f;
            border-radius: 5px;
            margin-top: 10px;
            padding: 5px;
            position: relative;
        }

        .chart-line {
            stroke: #00ff88;
            stroke-width: 2;
            fill: none;
        }

        .value-big {
            font-size: 1.8em;
            color: #00ff88;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(0,255,136,0.3);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .stat-card {
            background: #0a1628;
            border: 1px solid #2a3f5f;
            border-radius: 5px;
            padding: 8px;
            text-align: center;
        }

        .stat-card-label {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 4px;
        }

        .stat-card-value {
            font-size: 1.2em;
            color: #fff;
            font-weight: bold;
        }

        .warning {
            color: #ffaa00;
        }

        .danger {
            color: #ff4444;
        }

        .success {
            color: #00ff88;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° TRAINING LIVE MONITOR ‚ö°</h1>

        <!-- Overall Progress Bar -->
        <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="color: #00d9ff; font-weight: bold;">Overall Progress</span>
                <span id="overallProgressText" style="color: #00ff88; font-weight: bold;">0%</span>
            </div>
            <div class="progress-container" style="height: 30px;">
                <div id="overallProgressBar" class="progress-bar" style="width: 0%;">
                    <span id="overallProgressLabel">0%</span>
                </div>
            </div>
        </div>

        <div class="refresh-indicator">
            <span id="refreshStatus">Initializing...</span>
        </div>

        <div class="files-indicator" id="filesIndicator" style="display: none;">
            üìÅ Queued Files: <span class="files-badge" id="filesCount">0</span>
        </div>

        <div id="errorContainer"></div>

        <!-- Main Stats Grid -->
        <div class="grid">
            <!-- Training Status -->
            <div class="panel">
                <h2>üìä Training Status</h2>
                <div class="metric">
                    <span class="metric-label">Status</span>
                    <span class="metric-value" id="status">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Current Step</span>
                    <span class="metric-value" id="currentStep">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Steps</span>
                    <span class="metric-value" id="totalSteps">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Epoch</span>
                    <span class="metric-value" id="epoch">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Progress</span>
                    <span class="metric-value" id="progressPercent">0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Max Output Tokens</span>
                    <span class="metric-value success" id="maxOutputTokens">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Context Window</span>
                    <span class="metric-value success" id="contextWindow">-</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Loss Metrics -->
            <div class="panel">
                <h2>üìâ Loss Metrics</h2>
                <div class="value-big" id="currentLoss">-</div>
                <div class="metric">
                    <span class="metric-label">Learning Rate</span>
                    <span class="metric-value" id="learningRate">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Loss Trend</span>
                    <span class="metric-value" id="lossTrend">-</span>
                </div>
            </div>

            <!-- Speed & ETA -->
            <div class="panel">
                <h2>‚è±Ô∏è Speed & ETA</h2>
                <div class="metric">
                    <span class="metric-label">Steps/Second</span>
                    <span class="metric-value" id="stepsPerSec">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Examples/Second</span>
                    <span class="metric-value" id="examplesPerSec">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Time Elapsed</span>
                    <span class="metric-value" id="timeElapsed">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ETA Remaining</span>
                    <span class="metric-value" id="etaRemaining">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Estimated Completion</span>
                    <span class="metric-value" id="etaTime">-</span>
                </div>
            </div>
        </div>

        <!-- GPU Stats -->
        <div class="panel">
            <h2>üéÆ GPU Stats - <span id="gpuName">Loading...</span></h2>

            <div class="stat-grid" style="margin-bottom: 15px;">
                <div class="stat-card">
                    <div class="stat-card-label">Temperature</div>
                    <div class="stat-card-value" id="gpuTemp">-¬∞C</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Power Draw</div>
                    <div class="stat-card-value" id="gpuPower">- W</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">GPU Utilization</div>
                    <div class="stat-card-value" id="gpuUtilPercent">-%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Memory Used</div>
                    <div class="stat-card-value" id="gpuMemUsed">- GB</div>
                </div>
            </div>

            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>Temperature</span>
                    <span id="tempLabel">-¬∞C / 85¬∞C</span>
                </div>
                <div class="gpu-gauge">
                    <div class="gpu-gauge-fill gauge-temp" id="tempGauge" style="width: 0%"></div>
                </div>
            </div>

            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>GPU Utilization</span>
                    <span id="utilLabel">-%</span>
                </div>
                <div class="gpu-gauge">
                    <div class="gpu-gauge-fill gauge-util" id="utilGauge" style="width: 0%"></div>
                </div>
            </div>

            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>Memory</span>
                    <span id="memLabel">- GB / - GB</span>
                </div>
                <div class="gpu-gauge">
                    <div class="gpu-gauge-fill gauge-mem" id="memGauge" style="width: 0%"></div>
                </div>
            </div>

            <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>Power Draw</span>
                    <span id="powerLabel">- W / - W</span>
                </div>
                <div class="gpu-gauge">
                    <div class="gpu-gauge-fill gauge-power" id="powerGauge" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Running Accuracy -->
        <div class="panel">
            <h2>üéØ Running Accuracy</h2>
            <div class="value-big" id="accuracyPercent">-%</div>
            <div class="metric">
                <span class="metric-label">Correct / Total Evaluations</span>
                <span class="metric-value" id="accuracyFraction">- / -</span>
            </div>
        </div>

        <!-- Current Example -->
        <div class="grid-2">
            <div class="panel">
                <h2>üìù Current Prompt (Step <span id="currentExampleStep">-</span>)</h2>
                <div class="sample-box">
                    <pre id="prompt">Waiting for validation step...</pre>
                </div>
            </div>
            <div class="panel">
                <h2>‚úÖ Golden Answer</h2>
                <div class="sample-box">
                    <pre id="golden">Waiting for validation step...</pre>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>ü§ñ Model's Answer<span id="matchBadge"></span></h2>
            <div class="sample-box">
                <pre id="modelAnswer">Waiting for validation step...</pre>
            </div>
        </div>

        <!-- Recent Examples History -->
        <div class="panel">
            <h2>üìú Recent Examples (Last 5)</h2>
            <div id="recentExamples" style="font-size: 0.85em;">
                <p style="color: #888;">No examples yet...</p>
            </div>
        </div>
    </div>

    <script>
        const STATUS_FILE = '/status/training_status.json';
        const GPU_STATS_API = '/api/gpu_stats';
        const INBOX_FILES_API = '/api/inbox_files';
        const REFRESH_INTERVAL = 2000; // 2 seconds
        const EFFECTIVE_BATCH_SIZE = 8; // batch_size √ó gradient_accumulation

        let lastStep = 0;
        let lastTimestamp = null;
        let startStep = null;
        let startTime = null;
        let lossHistory = [];

        function formatTime(seconds) {
            if (!seconds || seconds < 0) return '-';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            if (hours > 0) {
                return `${hours}h ${minutes}m ${secs}s`;
            } else if (minutes > 0) {
                return `${minutes}m ${secs}s`;
            } else {
                return `${secs}s`;
            }
        }

        function updateTrainingStats(data) {
            // Status
            const statusEl = document.getElementById('status');
            statusEl.textContent = data.status.toUpperCase();
            statusEl.className = 'metric-value status-' + data.status;

            // Steps
            document.getElementById('currentStep').textContent = data.current_step.toLocaleString();
            document.getElementById('totalSteps').textContent = data.total_steps.toLocaleString();
            document.getElementById('epoch').textContent = data.epoch;

            // Progress
            const progress = (data.current_step / data.total_steps * 100);
            const progressPercent = progress.toFixed(1) + '%';
            document.getElementById('progressPercent').textContent = progressPercent;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progressPercent;
            progressBar.textContent = progressPercent;

            // Overall Progress Bar (top of page)
            const overallProgressBar = document.getElementById('overallProgressBar');
            const overallProgressText = document.getElementById('overallProgressText');
            const overallProgressLabel = document.getElementById('overallProgressLabel');
            overallProgressBar.style.width = progressPercent;
            overallProgressText.textContent = progressPercent;
            overallProgressLabel.textContent = progressPercent;

            // Config parameters
            document.getElementById('maxOutputTokens').textContent = data.max_output_tokens || 2048;
            document.getElementById('contextWindow').textContent = data.context_window || 2048;

            // Loss
            document.getElementById('currentLoss').textContent = data.loss.toFixed(4);
            document.getElementById('learningRate').textContent = data.learning_rate.toExponential(3);

            // Track loss history
            lossHistory.push(data.loss);
            if (lossHistory.length > 50) lossHistory.shift();

            // Loss trend
            if (lossHistory.length >= 2) {
                const recent = lossHistory.slice(-10);
                const avg = recent.reduce((a, b) => a + b, 0) / recent.length;
                const oldAvg = lossHistory.slice(-20, -10).reduce((a, b) => a + b, 0) / Math.min(10, lossHistory.length - 10);
                const trend = avg < oldAvg ? '‚Üì Decreasing' : avg > oldAvg ? '‚Üë Increasing' : '‚Üí Stable';
                document.getElementById('lossTrend').textContent = trend;
            }

            // Speed calculations
            const currentTimestamp = new Date(data.timestamp).getTime();

            if (!startStep) {
                startStep = data.current_step;
                startTime = currentTimestamp;
            }

            if (lastTimestamp && data.current_step > lastStep) {
                const timeDiff = (currentTimestamp - lastTimestamp) / 1000; // seconds
                const stepDiff = data.current_step - lastStep;
                const stepsPerSec = stepDiff / timeDiff;
                const examplesPerSec = stepsPerSec * EFFECTIVE_BATCH_SIZE;

                document.getElementById('stepsPerSec').textContent = stepsPerSec.toFixed(2);
                document.getElementById('examplesPerSec').textContent = examplesPerSec.toFixed(1);

                // ETA calculation
                const stepsRemaining = data.total_steps - data.current_step;
                const secondsRemaining = stepsRemaining / stepsPerSec;
                const etaDate = new Date(currentTimestamp + secondsRemaining * 1000);

                document.getElementById('etaRemaining').textContent = formatTime(secondsRemaining);
                document.getElementById('etaTime').textContent = etaDate.toLocaleTimeString();
            }

            // Time elapsed
            if (startTime) {
                const elapsed = (currentTimestamp - startTime) / 1000;
                document.getElementById('timeElapsed').textContent = formatTime(elapsed);
            }

            lastStep = data.current_step;
            lastTimestamp = currentTimestamp;

            // Running accuracy
            if (data.total_evals !== undefined) {
                document.getElementById('accuracyPercent').textContent = data.accuracy_percent.toFixed(1) + '%';
                document.getElementById('accuracyFraction').textContent = `${data.total_correct} / ${data.total_evals}`;
            }

            // Current example
            if (data.current_prompt) {
                document.getElementById('currentExampleStep').textContent = data.current_step.toLocaleString();
                document.getElementById('prompt').textContent = data.current_prompt;
                document.getElementById('golden').textContent = data.golden_answer || 'N/A';
                document.getElementById('modelAnswer').textContent = data.model_answer || 'N/A';

                const matchBadge = document.getElementById('matchBadge');
                if (data.answer_matches !== null) {
                    matchBadge.className = data.answer_matches ? 'match-badge match-yes' : 'match-badge match-no';
                    matchBadge.textContent = data.answer_matches ? 'MATCH ‚úì' : 'NO MATCH ‚úó';
                } else {
                    matchBadge.className = '';
                    matchBadge.textContent = '';
                }
            }

            // Recent examples
            if (data.recent_examples && data.recent_examples.length > 0) {
                const recentDiv = document.getElementById('recentExamples');
                let html = '';

                data.recent_examples.slice().reverse().forEach(ex => {
                    const matchIcon = ex.matches ? '‚úÖ' : '‚ùå';
                    const matchClass = ex.matches ? 'success' : 'danger';

                    html += `
                        <div style="border-bottom: 1px solid #2a3f5f; padding: 10px 0; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <strong>Step ${ex.step.toLocaleString()}</strong>
                                <span class="${matchClass}">${matchIcon} ${ex.matches ? 'Match' : 'No Match'} | Loss: ${ex.loss.toFixed(4)}</span>
                            </div>
                            <div style="font-size: 0.9em; color: #aaa;">
                                <div><strong>Q:</strong> ${ex.prompt}</div>
                                <div><strong>Expected:</strong> ${ex.golden}</div>
                                <div><strong>Got:</strong> ${ex.model_output}</div>
                            </div>
                        </div>
                    `;
                });

                recentDiv.innerHTML = html;
            }

            // Errors
            const errorContainer = document.getElementById('errorContainer');
            if (data.status === 'crashed') {
                errorContainer.innerHTML = `
                    <div class="error-panel">
                        <h2>‚ö†Ô∏è Training Crashed!</h2>
                        <div class="metric">
                            <span class="metric-label">Error Type</span>
                            <span class="metric-value">${data.error_type || 'Unknown'}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Error Message</span>
                            <span class="metric-value">${data.error_message || 'No details'}</span>
                        </div>
                    </div>
                `;
            } else {
                errorContainer.innerHTML = '';
            }
        }

        function updateGPUStats(gpu) {
            if (gpu.error) {
                document.getElementById('gpuName').textContent = 'Error loading GPU stats';
                return;
            }

            document.getElementById('gpuName').textContent = gpu.gpu_name;

            // Temperature
            const tempPercent = (gpu.temperature / 85) * 100; // 85¬∞C max safe temp
            document.getElementById('gpuTemp').textContent = `${gpu.temperature.toFixed(0)}¬∞C`;
            document.getElementById('tempLabel').textContent = `${gpu.temperature.toFixed(0)}¬∞C / 85¬∞C`;
            document.getElementById('tempGauge').style.width = Math.min(tempPercent, 100) + '%';

            const tempEl = document.getElementById('gpuTemp');
            if (gpu.temperature > 80) {
                tempEl.className = 'stat-card-value danger';
            } else if (gpu.temperature > 70) {
                tempEl.className = 'stat-card-value warning';
            } else {
                tempEl.className = 'stat-card-value success';
            }

            // GPU Utilization
            document.getElementById('gpuUtilPercent').textContent = `${gpu.gpu_utilization.toFixed(0)}%`;
            document.getElementById('utilLabel').textContent = `${gpu.gpu_utilization.toFixed(0)}%`;
            document.getElementById('utilGauge').style.width = gpu.gpu_utilization + '%';

            // Memory
            const memUsedGB = (gpu.memory_used_mb / 1024).toFixed(1);
            const memTotalGB = (gpu.memory_total_mb / 1024).toFixed(1);
            const memPercent = (gpu.memory_used_mb / gpu.memory_total_mb * 100).toFixed(0);
            document.getElementById('gpuMemUsed').textContent = `${memUsedGB} GB`;
            document.getElementById('memLabel').textContent = `${memUsedGB} GB / ${memTotalGB} GB (${memPercent}%)`;
            document.getElementById('memGauge').style.width = memPercent + '%';

            // Power
            const powerPercent = (gpu.power_draw_w / gpu.power_limit_w * 100).toFixed(0);
            document.getElementById('gpuPower').textContent = `${gpu.power_draw_w.toFixed(0)} W`;
            document.getElementById('powerLabel').textContent = `${gpu.power_draw_w.toFixed(0)} W / ${gpu.power_limit_w.toFixed(0)} W`;
            document.getElementById('powerGauge').style.width = powerPercent + '%';
        }

        async function fetchStatus() {
            const refreshStatus = document.getElementById('refreshStatus');
            try {
                refreshStatus.classList.add('pulse');

                // Fetch training status
                const statusResponse = await fetch(STATUS_FILE + '?t=' + Date.now());
                if (statusResponse.ok) {
                    const data = await statusResponse.json();
                    updateTrainingStats(data);
                    refreshStatus.textContent = `Updated: ${new Date().toLocaleTimeString()}`;
                } else {
                    refreshStatus.textContent = 'No training data';
                }

                // Fetch GPU stats
                const gpuResponse = await fetch(GPU_STATS_API + '?t=' + Date.now());
                if (gpuResponse.ok) {
                    const gpu = await gpuResponse.json();
                    updateGPUStats(gpu);
                }

                // Fetch inbox files
                const inboxResponse = await fetch(INBOX_FILES_API + '?t=' + Date.now());
                if (inboxResponse.ok) {
                    const inboxData = await inboxResponse.json();
                    updateInboxFiles(inboxData);
                }
            } catch (error) {
                refreshStatus.textContent = 'Error loading data';
                console.error('Failed to fetch data:', error);
            } finally {
                refreshStatus.classList.remove('pulse');
            }
        }

        function updateInboxFiles(data) {
            const filesIndicator = document.getElementById('filesIndicator');
            const filesCount = document.getElementById('filesCount');

            if (data.count > 0) {
                filesCount.textContent = data.count;
                filesIndicator.style.display = 'block';
                filesIndicator.title = data.files.map(f => `${f.name} (${f.size_mb.toFixed(1)} MB)`).join('\n');
            } else {
                filesIndicator.style.display = 'none';
            }
        }

        // Initial fetch
        fetchStatus();

        // Auto-refresh
        setInterval(fetchStatus, REFRESH_INTERVAL);
    </script>
</body>
</html>
