<!DOCTYPE html>
<html>
<head>
    <title>API Debug</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #0f0; padding: 20px; }
        pre { background: #000; padding: 10px; border: 1px solid #0f0; }
        .error { color: #f00; }
        .success { color: #0f0; }
    </style>
</head>
<body>
    <h1>Control Room API Debug</h1>
    <button onclick="testAPI()">Test API Now</button>
    <hr>
    <h2>Fetch Test:</h2>
    <pre id="fetchResult">Waiting...</pre>
    <h2>GPU Data:</h2>
    <pre id="gpuData">Waiting...</pre>

    <script>
    async function testAPI() {
        const output = document.getElementById('fetchResult');
        const gpuOutput = document.getElementById('gpuData');

        try {
            output.textContent = 'Fetching /api/status/live...';

            const response = await fetch('/api/status/live');
            output.textContent = `Response status: ${response.status}\n`;

            const data = await response.json();
            output.textContent += `Data received: ${JSON.stringify(data, null, 2)}`;

            // Test GPU rendering
            if (data.gpu_4090) {
                const gpu = data.gpu_4090;
                gpuOutput.innerHTML = `
<span class="success">✓ GPU Data Found</span>
Temperature: ${gpu.temp_c}°C
VRAM: ${gpu.vram_used_gb.toFixed(1)} / ${gpu.vram_total_gb.toFixed(0)} GB
Utilization: ${gpu.util_pct}%
Power: ${gpu.power_w} / ${gpu.power_limit_w} W
                `.trim();
            } else {
                gpuOutput.innerHTML = '<span class="error">✗ No GPU data in response</span>';
            }

        } catch (error) {
            output.innerHTML = `<span class="error">ERROR: ${error.message}\n${error.stack}</span>`;
        }
    }

    // Auto-test on load
    testAPI();
    setInterval(testAPI, 5000);
    </script>
</body>
</html>
