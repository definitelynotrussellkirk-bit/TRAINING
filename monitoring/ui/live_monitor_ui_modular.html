<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Training Live Monitor - Ultra Enhanced</title>
    <!-- Favicon for professional tab appearance -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>‚ö°</text></svg>">
    <!-- External CSS for easier maintenance -->
    <link rel="stylesheet" href="/monitoring/css/monitor_styles.css">
</head>
<body class="theme-dark">
    <!-- NEW: Flagged Examples Floating Panel -->
    <div id="flaggedPanel" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">üö© Flagged Training Examples</h2>
                <button id="closeFlaggedPanel" style="padding: 5px 15px; background: rgba(255, 68, 68, 0.2); border: 1px solid #ff4444; color: #ff4444; border-radius: 5px; cursor: pointer; font-size: 1em;">‚úï Close</button>
            </div>

            <!-- Statistics Summary -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                <div style="background: rgba(42, 63, 95, 0.3); padding: 10px; border-radius: 5px; text-align: center;">
                    <div style="color: #888; font-size: 0.9em;">Total Flagged</div>
                    <div id="flaggedTotal" style="color: #00d9ff; font-size: 1.5em; font-weight: bold;">0</div>
                </div>
                <div style="background: rgba(42, 63, 95, 0.3); padding: 10px; border-radius: 5px; text-align: center;">
                    <div style="color: #888; font-size: 0.9em;">Mismatches</div>
                    <div id="flaggedMismatches" style="color: #ff4444; font-size: 1.5em; font-weight: bold;">0</div>
                </div>
                <div style="background: rgba(42, 63, 95, 0.3); padding: 10px; border-radius: 5px; text-align: center;">
                    <div style="color: #888; font-size: 0.9em;">High Loss</div>
                    <div id="flaggedHighLoss" style="color: #ffaa00; font-size: 1.5em; font-weight: bold;">0</div>
                </div>
                <div style="background: rgba(42, 63, 95, 0.3); padding: 10px; border-radius: 5px; text-align: center;">
                    <div style="color: #888; font-size: 0.9em;">Avg Loss</div>
                    <div id="flaggedAvgLoss" style="color: #00ff88; font-size: 1.5em; font-weight: bold;">0.00</div>
                </div>
            </div>

            <!-- Filter Controls -->
            <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                <select id="flaggedFilter" style="padding: 8px 12px; background: rgba(42, 63, 95, 0.5); border: 1px solid #00d9ff; color: #00d9ff; border-radius: 5px; cursor: pointer; font-size: 0.95em;">
                    <option value="all">All Flagged</option>
                    <option value="mismatch">Mismatches Only</option>
                    <option value="high_loss">High Loss Only</option>
                    <option value="error">Errors Only</option>
                </select>
                <select id="flaggedSort" style="padding: 8px 12px; background: rgba(42, 63, 95, 0.5); border: 1px solid #00d9ff; color: #00d9ff; border-radius: 5px; cursor: pointer; font-size: 0.95em;">
                    <option value="recent">Most Recent First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="highest_loss">Highest Loss First</option>
                    <option value="lowest_loss">Lowest Loss First</option>
                </select>
                <button id="refreshFlagged" style="padding: 8px 15px; background: rgba(0, 217, 255, 0.2); border: 1px solid #00d9ff; color: #00d9ff; border-radius: 5px; cursor: pointer; font-size: 0.95em;">üîÑ Refresh</button>
            </div>

            <!-- Examples List (scrollable) -->
            <div id="flaggedExamplesList" style="flex: 1; overflow-y: auto; padding-right: 10px;">
                <div style="text-align: center; padding: 40px; color: #888;">
                    Loading flagged examples...
                </div>
            </div>
        </div>
    </div>

    <!-- ALWAYS-VISIBLE STATUS BAR (Persistent Summary) -->
    <div id="statusBar" class="status-bar-persistent">
        <!-- Binary Health Indicator -->
        <div class="health-indicator">
            <div class="health-dot" id="healthDot" title="System Health"></div>
            <span class="health-label" id="healthLabel">INITIALIZING</span>
        </div>

        <!-- Large Primary Metrics -->
        <div class="summary-metric">
            <span class="summary-label">STATUS</span>
            <span class="summary-value huge" id="summaryStatus">LOADING</span>
        </div>

        <div class="summary-metric">
            <span class="summary-label">LOSS</span>
            <span class="summary-value big" id="summaryLoss">
                <span id="lossValue">-</span>
                <span class="delta-indicator" id="lossDelta"></span>
            </span>
        </div>

        <div class="summary-metric">
            <span class="summary-label">PROGRESS</span>
            <span class="summary-value big" id="summaryProgress">
                <span id="progressValue">0%</span>
            </span>
        </div>

        <div class="summary-metric">
            <span class="summary-label">GPU TEMP</span>
            <span class="summary-value medium" id="summaryGPU">
                <span id="gpuValue">-¬∞C</span>
                <span class="delta-indicator" id="gpuDelta"></span>
            </span>
        </div>

        <div class="summary-metric">
            <span class="summary-label">VRAM</span>
            <span class="summary-value medium" id="summaryVRAM">
                <span id="vramValue">- GB</span>
                <span class="delta-indicator" id="vramDelta"></span>
            </span>
        </div>

        <div class="summary-metric">
            <span class="summary-label">RAM</span>
            <span class="summary-value medium" id="summaryRAM">
                <span id="ramValue">- GB</span>
                <span class="delta-indicator" id="ramDelta"></span>
            </span>
        </div>

        <div class="summary-metric">
            <span class="summary-label">QUEUE</span>
            <span class="summary-value medium" id="summaryQueue">
                <span id="queueValue">-</span>
            </span>
        </div>
    </div>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h1 style="margin: 0;">‚ö° TRAINING LIVE MONITOR ‚ö°</h1>
            <div style="display: flex; gap: 10px;">
                <button id="pauseToggle" class="control-button" aria-pressed="false">‚è∏Ô∏è Pause</button>
                <button id="viewFlaggedButton" class="control-button">üö© Flagged (<span id="flaggedCount">0</span>)</button>
                <button id="soundToggle" class="control-button" aria-pressed="false">üîî Sound ON</button>
            </div>
        </div>

        <!-- Training Timer & ETA Countdown -->
        <div class="grid" style="margin-bottom: 15px;">
            <div class="timer-panel">
                <h3>‚è±Ô∏è Training Duration</h3>
                <div class="timer-display" id="trainingTimer">00:00:00</div>
            </div>
            <div class="timer-panel">
                <h3>‚è∞ ETA Current File</h3>
                <div class="timer-display" id="etaCountdown">00:00:00</div>
            </div>
            <div class="timer-panel throughput-panel">
                <h3>üìä Throughput
                    <div class="tooltip-icon inline" style="margin-left: 5px;">‚ÑπÔ∏è
                        <span class="tooltiptext">
                            <div class="tooltip-header">Data Throughput</div>
                            Measures how fast training data is being processed.
                            <br><br>
                            <strong>Calculated from:</strong><br>
                            ‚Ä¢ File size (MB) of completed batches<br>
                            ‚Ä¢ Time taken to train on each batch<br>
                            ‚Ä¢ Rolling average over recent batches
                            <br><br>
                            <strong>Typical values:</strong><br>
                            ‚Ä¢ 10-20 MB/hour: Normal for 7B model<br>
                            ‚Ä¢ 20-40 MB/hour: Fast GPU/settings<br>
                            ‚Ä¢ < 10 MB/hour: Check GPU utilization
                            <br><br>
                            <strong>Used to estimate:</strong><br>
                            Queue completion time = (Total queued MB) √∑ (MB/hour)
                        </span>
                    </div>
                </h3>
                <div class="timer-display" id="throughput" style="font-size: 2em;">-- MB/hr</div>
                <div id="throughputDetails" style="font-size: 0.7em; color: #888; margin-top: 5px;">No data yet</div>
            </div>
        </div>

        <!-- Queue Time Estimator -->
        <div id="queueEstimator" class="panel queue-estimator" style="display: none; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h2 style="margin: 0;">üìÅ Queue Time Estimator
                    <div class="tooltip-icon" style="margin-left: 5px;">‚ÑπÔ∏è
                        <span class="tooltiptext">
                            <div class="tooltip-header">Queue Completion Estimate</div>
                            Predicts when ALL queued files in inbox/ will finish training.
                            <br><br>
                            <strong>Calculation:</strong><br>
                            1. Sum all queued file sizes (MB)<br>
                            2. Divide by current throughput (MB/hour)<br>
                            3. Add to current time
                            <br><br>
                            <strong>Accuracy improves with:</strong><br>
                            ‚Ä¢ More completed batches (better average)<br>
                            ‚Ä¢ Stable training speed<br>
                            ‚Ä¢ Similar file sizes
                            <br><br>
                            <strong>Note:</strong> Estimate updates as throughput changes. First batch has no history, so initial estimate may be rough.
                        </span>
                    </div>
                </h2>
                <button id="toggleFileDetailsBtn" style="padding: 5px 12px; background: rgba(0, 217, 255, 0.2); border: 1px solid #00d9ff; color: #00d9ff; border-radius: 5px; cursor: pointer; font-size: 0.9em;">
                    üìã Show Details
                </button>
            </div>
            <div class="queue-stats">
                <div class="queue-stat">
                    <span class="queue-label">Files Queued:</span>
                    <span class="queue-value" id="queueCount">-</span>
                </div>
                <div class="queue-stat">
                    <span class="queue-label">Total Size:</span>
                    <span class="queue-value" id="queueSize">- MB</span>
                </div>
                <div class="queue-stat">
                    <span class="queue-label">Est. Time Remaining:</span>
                    <span class="queue-value highlight" id="queueETA">00:00:00</span>
                </div>
                <div class="queue-stat">
                    <span class="queue-label">Est. Completion:</span>
                    <span class="queue-value highlight" id="queueCompleteTime">---</span>
                </div>
            </div>

            <!-- Detailed File List (expandable) -->
            <div id="queuedFilesList" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0, 217, 255, 0.2);">
                <h3 style="margin-bottom: 10px; color: #00d9ff; font-size: 0.95em;">üìã Queued Files Details</h3>
                <div id="filesListContainer" style="max-height: 300px; overflow-y: auto;">
                    <!-- Files will be inserted here -->
                </div>
            </div>
        </div>

        <div class="panel" id="advancedAnalyticsPanel" style="margin-bottom: 15px;">
            <h2>üß† Advanced Analytics</h2>
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Penalty Hits</h3>
                    <div id="penaltyStats" class="analytics-content">Collecting‚Ä¶</div>
                </div>
                <div class="analytics-card">
                    <h3>Queue Velocity</h3>
                    <div id="queueVelocityStats" class="analytics-content">--</div>
                </div>
                <div class="analytics-card">
                    <h3>Length Coverage</h3>
                    <div id="lengthCoverageList" class="analytics-content">--</div>
                </div>
                <div class="analytics-card">
                    <h3>Pattern Loss</h3>
                    <div id="patternLossList" class="analytics-content">--</div>
                </div>
                <div class="analytics-card">
                    <h3>Pattern ‚áÑ Layer</h3>
                    <div id="patternLayerList" class="analytics-content">--</div>
                </div>
                <div class="analytics-card">
                    <h3>Layer Stability</h3>
                    <div id="layerStabilityList" class="analytics-content">--</div>
                </div>
            </div>
            <div class="analytics-subpanel">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                    <h3 style="margin:0;">Throughput vs VRAM</h3>
                    <span id="vramScatterStatus" class="muted small-text">Waiting for samples‚Ä¶</span>
                </div>
                <canvas id="vramScatter" width="640" height="240" style="width: 100%; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(5,10,20,0.6);"></canvas>
            </div>
        </div>

        <!-- ========================================
             OVERALL PROGRESS BAR SECTION
             ======================================== -->
        <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="color: #00d9ff; font-weight: bold;">Overall Progress
                    <div class="tooltip-icon inline" style="margin-left: 5px;">‚ÑπÔ∏è
                        <span class="tooltiptext">
                            <div class="tooltip-header">Overall Progress</div>
                            Shows current training step / total training steps for the current batch.
                            <br><br>
                            <strong>In your setup:</strong><br>
                            ‚Ä¢ Each .jsonl file in inbox/ becomes one "batch"<br>
                            ‚Ä¢ This shows progress through the CURRENT file<br>
                            ‚Ä¢ 100% = current file completed, moves to next file
                            <br><br>
                            <strong>Multiple files:</strong><br>
                            If you have 3 files queued, this will go 0‚Üí100% three times (once per file)
                            <br><br>
                            <strong>Continuous training:</strong><br>
                            Adapter preserves learning between batches via checkpoints
                        </span>
                    </div>
                </span>
                <span id="overallProgressText" style="color: #00ff88; font-weight: bold;">0%</span>
            </div>
            <div id="overallProgressContainer"
                 class="progress-container"
                 style="height: 30px;"
                 role="progressbar"
                 aria-label="Overall Progress"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 aria-valuenow="0">
                <div id="overallProgressBar" class="progress-bar" style="width: 0%;">
                    <span id="overallProgressLabel">0%</span>
                </div>
            </div>
        </div>

        <!-- ========================================
             STATUS INDICATORS (Top Right)
             ======================================== -->
        <div class="refresh-indicator">
            <span id="refreshStatus">Initializing...</span>
        </div>

        <div class="files-indicator" id="filesIndicator" style="display: none; cursor: pointer;" title="Click to show/hide file details">
            üìÅ Queued Files: <span class="files-badge" id="filesCount">0</span>
            <span id="filesToggleIcon" style="margin-left: 5px; font-size: 0.8em;">‚ñº</span>
        </div>

        <!-- ========================================
             ERROR MESSAGES (if any)
             ======================================== -->
        <div id="errorContainer"></div>

        <!-- ========================================
             LORA CONFIGURATION SECTION
             ======================================== -->
        <div class="section-divider">‚öôÔ∏è MODEL CONFIGURATION</div>
        <div class="grid-4 compactable" style="margin-bottom: 15px;">
            <!-- Layer Monitor: total layers -->
            <div class="panel panel-lora">
                <h2>üî¢ Layers Tracked
                    <div class="tooltip-icon">‚ÑπÔ∏è
                        <span class="tooltiptext">
                            <div class="tooltip-header">Layer Groups</div>
                            Shows how many transformer blocks the layer monitor is tracking in the current run. During full-model training every block is tracked; during adapter-only runs this matches the number of trainable layers.
                        </span>
                    </div>
                </h2>
                <div class="value-big" id="loraRank" style="font-size: 2em;">-</div>
            </div>

            <!-- Layer Monitor: avg delta -->
            <div class="panel panel-lora">
                <h2>‚öñÔ∏è Avg Œî (Weight Norm)
                    <div class="tooltip-icon">‚ÑπÔ∏è
                        <span class="tooltiptext">
                            <div class="tooltip-header">Average Layer Delta</div>
                            Displays the mean change in weight norm between snapshots across all monitored layers. Larger values mean the model is adapting more aggressively.
                        </span>
                    </div>
                </h2>
                <div class="value-big" id="loraAlpha" style="font-size: 2em;">-</div>
            </div>

            <!-- Batch size / accumulation -->
            <div class="panel panel-config">
                <h2>üéØ Batch & Accumulation
                    <div class="tooltip-icon">‚ÑπÔ∏è
                        <span class="tooltiptext">
                            <div class="tooltip-header">Effective Batch Size</div>
                            Shows the per-device batch size and gradient accumulation steps flowing through the trainer. Effective batch = batch √ó accumulation.
                        </span>
                    </div>
                </h2>
                <div style="display:flex; justify-content:space-around; font-size:1.2em; margin-top:10px;">
                    <div>
                        <div class="muted small-text">Batch</div>
                        <div id="batchSize">-</div>
                    </div>
                    <div>
                        <div class="muted small-text">Acc</div>
                        <div id="gradAccum">-</div>
                    </div>
                    <div>
                        <div class="muted small-text">Effective</div>
                        <div id="effectiveBatch">-</div>
                    </div>
                </div>
            </div>

            <!-- Model Name -->
            <div class="panel panel-config">
                <h2>ü§ñ Base Model</h2>
                <div style="margin-top: 15px; text-align: center; font-size: 1em; color: #00d9ff; font-weight: bold;" id="modelName">-</div>
            </div>
        </div>

        <!-- ========================================
             MAIN STATISTICS GRID
             ======================================== -->
        <div class="section-divider">üìä TRAINING METRICS</div>
        <div class="grid compactable">
            <!-- Training Status -->
            <div class="panel">
                <h2>üìä Training Status</h2>
                <div class="metric">
                    <span class="metric-label">Status
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Training Status</div>
                                <strong>idle:</strong> Waiting for data<br>
                                <strong>training:</strong> Actively training<br>
                                <strong>completed:</strong> Finished<br>
                                <strong>crashed:</strong> Error occurred
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="status">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Current Step
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Current Step</div>
                                Training step number. Each step processes one batch of examples.
                                <br><br>
                                <strong>Batch size √ó accumulation steps = effective batch</strong><br>
                                Current: 1 √ó 8 = 8 examples per step
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="currentStep">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Steps
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Total Steps</div>
                                Total training steps for this run.
                                <br><br>
                                Calculated as: (Dataset size √∑ Effective batch size) √ó Epochs
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="totalSteps">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Epoch
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Epoch</div>
                                One complete pass through the entire training dataset.
                                <br><br>
                                <strong>Common practice:</strong><br>
                                1 epoch for large datasets<br>
                                3-10 epochs for smaller datasets
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="epoch">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Progress</span>
                    <span class="metric-value" id="progressPercent">0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Max Output Tokens
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Max Output Tokens</div>
                                Maximum tokens the model can generate in responses.
                                <br><br>
                                <strong>Typical values:</strong><br>
                                ‚Ä¢ 256-512: Short answers<br>
                                ‚Ä¢ 1024-2048: Medium responses<br>
                                ‚Ä¢ 4096+: Long-form content
                                <br><br>
                                <strong>Effects:</strong><br>
                                Higher = More VRAM, longer generation time
                            </span>
                        </div>
                    </span>
                    <span class="metric-value success" id="maxOutputTokens">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Context Window
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Context Window</div>
                                Maximum total tokens (input + output) model can process at once.
                                <br><br>
                                <strong>Typical values:</strong><br>
                                ‚Ä¢ 2048: Older models<br>
                                ‚Ä¢ 4096-8192: Standard<br>
                                ‚Ä¢ 32768+: Extended context
                                <br><br>
                                <strong>Influences:</strong><br>
                                ‚Ä¢ How much conversation history fits<br>
                                ‚Ä¢ VRAM usage (grows quadratically!)<br>
                                ‚Ä¢ Training/inference speed
                                <br><br>
                                Larger context = exponentially more memory & compute
                            </span>
                        </div>
                    </span>
                    <span class="metric-value success" id="contextWindow">-</span>
                </div>
                <div class="progress-container" role="progressbar" aria-label="Training Progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" id="progressContainer">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Loss Metrics with Sparkline -->
            <div class="panel">
                <h2>üìâ Loss Metrics</h2>
                <div class="value-big" id="currentLoss" style="position: relative;">
                    -
                    <div class="tooltip-icon" style="font-size: 0.4em; position: absolute; top: 5px; right: 5px;">‚ÑπÔ∏è
                        <span class="tooltiptext">
                            <div class="tooltip-header">Training Loss</div>
                            Measures how wrong the model's predictions are. Lower = better.
                            <br><br>
                            <strong>Typical progression:</strong><br>
                            ‚Ä¢ Start: 2.0-4.0 (random)<br>
                            ‚Ä¢ Early training: 1.0-2.0<br>
                            ‚Ä¢ Well-trained: 0.3-0.8<br>
                            ‚Ä¢ Overfitting: < 0.1
                            <br><br>
                            Color coding: Green=improving, Red=worsening, Orange=stable
                        </span>
                    </div>
                </div>
                <!-- Loss Sparkline Chart -->
                <canvas id="lossSparkline" width="250" height="60" style="width: 100%; height: 60px; margin: 10px 0;"></canvas>

                <!-- NEW: Validation Loss -->
                <div class="metric">
                    <span class="metric-label">Validation Loss
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Validation Loss</div>
                                Loss calculated on held-out validation set (never seen during training).
                                <br><br>
                                <strong>Compares to Training Loss:</strong><br>
                                ‚Ä¢ Green: Val ‚âà Train (generalizing well)<br>
                                ‚Ä¢ Yellow: Val slightly > Train (gap 0.2-0.5)<br>
                                ‚Ä¢ Red: Val >> Train (gap > 0.5 - overfitting!)
                                <br><br>
                                Calculated every 50 steps during eval.
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="validationLoss">--</span>
                </div>

                <!-- NEW: Streaming CE (EMA) -->
                <div class="metric">
                    <span class="metric-label">Streaming CE (EMA-300)
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Streaming Cross-Entropy (Smoothed)</div>
                                Exponential moving average of loss over ~300 steps.
                                <br><br>
                                <strong>Why this matters:</strong> Per-step loss is noisy. This smooths it out.
                                <br><br>
                                Use this instead of raw loss to see true trends.
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="streamingCE">-</span>
                </div>

                <!-- NEW: Token Entropy -->
                <div class="metric">
                    <span class="metric-label">Token Entropy (current)
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Token-Level Entropy</div>
                                Average uncertainty per token. Measures how "spread out" the probability distribution is.
                                <br><br>
                                <strong>High entropy:</strong> Model is unsure (multiple plausible tokens)<br>
                                <strong>Low entropy:</strong> Model is confident (one clear answer)
                                <br><br>
                                Typical range: 0.5-3.0
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="tokenEntropy">-</span>
                </div>

                <div class="metric">
                    <span class="metric-label">Learning Rate
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Learning Rate</div>
                                Controls how much the model updates per step.
                                <br><br>
                                <strong>Typical values:</strong><br>
                                ‚Ä¢ 1e-5 to 5e-5: Conservative<br>
                                ‚Ä¢ 1e-4 to 5e-4: Standard<br>
                                ‚Ä¢ 1e-3+: Aggressive (risky)
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="learningRate">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Loss Trend
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Loss Trend</div>
                                Compares recent 10 steps vs previous 10 steps.
                                <br><br>
                                <strong>‚Üì Decreasing:</strong> Model learning (good!)<br>
                                <strong>‚Üë Increasing:</strong> Potential problem<br>
                                <strong>‚Üí Stable:</strong> Plateaued
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="lossTrend">-</span>
                </div>
            </div>

            <!-- Speed & ETA -->
            <div class="panel">
                <h2>‚è±Ô∏è Speed & ETA</h2>

                <!-- NEW: Tokens/sec -->
                <div class="metric">
                    <span class="metric-label">Tokens/Second
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Tokens Per Second</div>
                                Actual throughput in tokens (proper normalization).
                                <br><br>
                                <strong>Why this matters:</strong> MB/hr varies with file size. Tokens/sec is consistent.
                                <br><br>
                                <strong>Typical for sub-1B models:</strong><br>
                                ‚Ä¢ 4000-8000 tok/s: Good<br>
                                ‚Ä¢ 8000-15000 tok/s: Excellent<br>
                                ‚Ä¢ < 4000 tok/s: Check GPU utilization
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="tokensPerSec">-</span>
                </div>

                <!-- NEW: Effective tokens/step -->
                <div class="metric">
                    <span class="metric-label">Effective Tokens/Step
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Effective Tokens Per Step</div>
                                Total tokens processed per training step (batch √ó accumulation √ó avg length).
                                <br><br>
                                Higher = more compute per step, but slower steps.
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="tokensPerStep">-</span>
                </div>

                <div class="metric">
                    <span class="metric-label">Steps/Second
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Steps Per Second</div>
                                Training throughput - how fast steps complete.
                                <br><br>
                                <strong>Typical ranges:</strong><br>
                                ‚Ä¢ 0.5-1.0: Normal for 7B model<br>
                                ‚Ä¢ 1.0-2.0: Fast (good GPU)<br>
                                ‚Ä¢ < 0.5: Slow (check GPU util)
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="stepsPerSec">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Examples/Second
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Examples Per Second</div>
                                Training examples processed per second.
                                <br><br>
                                Calculated: steps/sec √ó effective batch size (8)
                                <br><br>
                                Higher = faster training, but quality depends on other factors
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="examplesPerSec">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Time Elapsed</span>
                    <span class="metric-value" id="timeElapsed">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ETA Remaining</span>
                    <span class="metric-value" id="etaRemaining">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Estimated Completion</span>
                    <span class="metric-value" id="etaTime">-</span>
                </div>
            </div>
        </div>

        <div class="section-divider">üéÆ HARDWARE STATUS</div>

        <!-- System RAM Stats -->
        <div class="panel compactable">
            <h2>üíæ System RAM - <span id="ramStatus">Loading...</span></h2>

            <div class="stat-grid" style="margin-bottom: 15px;">
                <div class="stat-card">
                    <div class="stat-card-label">Used RAM
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">System RAM Usage</div>
                                Total system memory in use.
                                <br><br>
                                <strong>Warning levels:</strong><br>
                                ‚Ä¢ < 70%: Safe (green)<br>
                                ‚Ä¢ 70-85%: Caution (yellow)<br>
                                ‚Ä¢ > 85%: High risk (red) - OOM killer may activate<br>
                                <br>
                                Monitor this during training to prevent crashes!
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-value" id="ramUsed">- GB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Training Process
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Training Process Memory</div>
                                RAM used by the Python training process.
                                <br><br>
                                <strong>Typical usage:</strong><br>
                                ‚Ä¢ 5-15 GB: Normal (tokenization phase)<br>
                                ‚Ä¢ 15-30 GB: Medium load<br>
                                ‚Ä¢ > 40 GB: Memory leak risk!<br>
                                <br>
                                If this grows continuously, may indicate memory leak.
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-value" id="trainingRAM">- GB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Available RAM
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Available RAM</div>
                                RAM available for new processes.
                                <br><br>
                                System keeps buffers/cache that can be freed if needed.<br>
                                This shows truly available memory.
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-value" id="ramAvailable">- GB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">OOM Risk
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Out of Memory Risk</div>
                                Risk level of OOM killer terminating processes.
                                <br><br>
                                <strong>LOW:</strong> Plenty of RAM (< 70%)<br>
                                <strong>MEDIUM:</strong> Getting full (70-85%)<br>
                                <strong>HIGH:</strong> Critical (> 85%) - crash imminent!<br>
                                <br>
                                If HIGH, consider restarting training or reducing dataset size.
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-value" id="oomRisk">LOW</div>
                </div>
            </div>

            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>System RAM</span>
                    <span id="ramLabel">- GB / - GB</span>
                </div>
                <div class="gpu-gauge" id="ramGaugeWrap" role="progressbar" aria-label="System RAM" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="gpu-gauge-fill gauge-mem" id="ramGauge" style="width: 0%"></div>
                </div>
            </div>

            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>Training Process</span>
                    <span id="trainingRAMLabel">- GB</span>
                </div>
                <div class="gpu-gauge" id="trainingRAMGaugeWrap" role="progressbar" aria-label="Training Process RAM" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="gpu-gauge-fill gauge-power" id="trainingRAMGauge" style="width: 0%"></div>
                </div>
            </div>

            <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>Swap Usage</span>
                    <span id="swapLabel">- GB / - GB</span>
                </div>
                <div class="gpu-gauge" id="swapGaugeWrap" role="progressbar" aria-label="Swap Usage" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="gpu-gauge-fill gauge-util" id="swapGauge" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- GPU Stats -->
        <div class="panel compactable">
            <h2>üéÆ GPU Stats - <span id="gpuName">Loading...</span></h2>

            <div class="stat-grid" style="margin-bottom: 15px;">
                <div class="stat-card">
                    <div class="stat-card-label">Temperature
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">GPU Temperature</div>
                                <strong>Safe ranges:</strong><br>
                                ‚Ä¢ < 70¬∞C: Cool (ideal)<br>
                                ‚Ä¢ 70-80¬∞C: Warm (normal)<br>
                                ‚Ä¢ 80-85¬∞C: Hot (careful)<br>
                                ‚Ä¢ > 85¬∞C: Too hot! (reduce load)
                                <br><br>
                                <strong>Causes of high temp:</strong><br>
                                ‚Ä¢ High GPU utilization<br>
                                ‚Ä¢ Poor cooling/ventilation<br>
                                ‚Ä¢ Large batch sizes
                                <br><br>
                                Monitor turns red > 80¬∞C
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-value" id="gpuTemp">-¬∞C</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Power Draw
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Power Draw</div>
                                Current power consumption vs max rated power.
                                <br><br>
                                <strong>Typical for training:</strong><br>
                                ‚Ä¢ 50-80% of max: Normal<br>
                                ‚Ä¢ 80-100%: High utilization (good!)<br>
                                ‚Ä¢ < 50%: Underutilized GPU
                                <br><br>
                                Higher = more compute happening (usually good during training)
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-value" id="gpuPower">- W</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">GPU Utilization
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">GPU Utilization</div>
                                Percentage of GPU compute cores actively working.
                                <br><br>
                                <strong>Target for training:</strong><br>
                                ‚Ä¢ 80-100%: Excellent (GPU fully utilized)<br>
                                ‚Ä¢ 50-80%: Good<br>
                                ‚Ä¢ < 50%: CPU bottleneck or waiting for data
                                <br><br>
                                <strong>Low utilization causes:</strong><br>
                                ‚Ä¢ Data loading too slow<br>
                                ‚Ä¢ Batch size too small<br>
                                ‚Ä¢ CPU preprocessing bottleneck
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-value" id="gpuUtilPercent">-%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Memory Used
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">GPU Memory (VRAM)</div>
                                Video memory used for model weights, activations, and gradients.
                                <br><br>
                                <strong>What uses VRAM:</strong><br>
                                ‚Ä¢ Model base weights (largest)<br>
                                ‚Ä¢ LoRA adapter weights<br>
                                ‚Ä¢ Batch size √ó sequence length<br>
                                ‚Ä¢ Gradient accumulation buffers<br>
                                ‚Ä¢ Optimizer states (Adam = 2x params)
                                <br><br>
                                <strong>Running out of memory:</strong><br>
                                Reduce batch size, sequence length, or LoRA rank
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-value" id="gpuMemUsed">- GB</div>
                </div>
            </div>

            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>Temperature</span>
                    <span id="tempLabel">-¬∞C / 85¬∞C</span>
                </div>
                <div class="gpu-gauge" id="tempGaugeWrap" role="progressbar" aria-label="GPU Temperature" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="gpu-gauge-fill gauge-temp" id="tempGauge" style="width: 0%"></div>
                </div>
            </div>

            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>GPU Utilization</span>
                    <span id="utilLabel">-%</span>
                </div>
                <div class="gpu-gauge" id="utilGaugeWrap" role="progressbar" aria-label="GPU Utilization" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="gpu-gauge-fill gauge-util" id="utilGauge" style="width: 0%"></div>
                </div>
            </div>

            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>Memory</span>
                    <span id="memLabel">- GB / - GB</span>
                </div>
                <div class="gpu-gauge" id="memGaugeWrap" role="progressbar" aria-label="GPU Memory" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="gpu-gauge-fill gauge-mem" id="memGauge" style="width: 0%"></div>
                </div>
            </div>

            <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85em;">
                    <span>Power Draw</span>
                    <span id="powerLabel">- W / - W</span>
                </div>
                <div class="gpu-gauge" id="powerGaugeWrap" role="progressbar" aria-label="Power Draw" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="gpu-gauge-fill gauge-power" id="powerGauge" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div class="section-divider">üéØ EVALUATION RESULTS</div>

        <!-- Smart Alerts (NEW) -->
        <div id="smartAlerts" style="margin-bottom: 15px;"></div>

        <!-- Fixed Eval Set (NEW) - GROUND TRUTH SIGNAL -->
        <div class="panel compactable">
            <h2>üéØ Fixed Eval Set (Ground Truth)
                <div class="tooltip-icon">‚ÑπÔ∏è
                    <span class="tooltiptext">
                        <div class="tooltip-header">Fixed Validation Set</div>
                        Held-out examples (never trained on) for true performance signal.
                        <br><br>
                        <strong>EM (Exact Match):</strong> % of perfect matches<br>
                        <strong>CE (Cross Entropy):</strong> Teacher-forced loss (no label smoothing)<br>
                        <strong>ECE (Calibration Error):</strong> How well confidence matches accuracy
                        <br><br>
                        This is your <strong>north star</strong> - streaming loss is noisy, this is truth.
                    </span>
                </div>
            </h2>
            <div class="metric">
                <span class="metric-label">Exact Match (EM)</span>
                <span class="metric-value" id="fixedEvalEM">-%</span>
            </div>
            <div class="metric">
                <span class="metric-label">Cross Entropy (CE)</span>
                <span class="metric-value" id="fixedEvalCE">-</span>
            </div>
            <div class="metric">
                <span class="metric-label">ECE (Calibration)</span>
                <span class="metric-value" id="fixedEvalECE">-</span>
            </div>
            <div class="metric">
                <span class="metric-label">Best Checkpoint</span>
                <span class="metric-value highlight" id="fixedEvalBest">‚Äî</span>
            </div>
            <div class="metric">
                <span class="metric-label">Trend</span>
                <span class="metric-value" id="fixedEvalTrend">-</span>
            </div>
        </div>

        <!-- Running Accuracy -->
        <div class="panel compactable">
            <h2>üéØ Running Accuracy
                <div class="tooltip-icon">‚ÑπÔ∏è
                    <span class="tooltiptext">
                        <div class="tooltip-header">Running Accuracy</div>
                        Percentage of evaluation examples where model output exactly matches expected answer.
                        <br><br>
                        <strong>Interpretation:</strong><br>
                        ‚Ä¢ > 90%: Excellent learning<br>
                        ‚Ä¢ 70-90%: Good progress<br>
                        ‚Ä¢ 50-70%: Early training<br>
                        ‚Ä¢ < 50%: Just starting
                        <br><br>
                        Note: Evaluations happen every 25 steps on training examples
                    </span>
                </div>
            </h2>
            <div class="value-big" id="accuracyPercent">-%</div>
            <div class="metric">
                <span class="metric-label">Correct / Total Evaluations</span>
                <span class="metric-value" id="accuracyFraction">- / -</span>
            </div>

            <!-- Accuracy Trends Section -->
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #2a3f5f;">
                <h3 style="font-size: 1em; margin-bottom: 10px; color: #00d9ff;">üìà Accuracy Trends
                    <div class="tooltip-icon inline" style="margin-left: 5px;">‚ÑπÔ∏è
                        <span class="tooltiptext">
                            <div class="tooltip-header">Accuracy Trends</div>
                            Compares accuracy over different time windows to show learning progress.
                            <br><br>
                            <strong>Last 20 evals:</strong> Most recent performance (short-term)<br>
                            <strong>Last 50 evals:</strong> Medium-term trend<br>
                            <strong>Overall:</strong> All-time average since training started
                            <br><br>
                            <strong>What to look for:</strong><br>
                            ‚Ä¢ Recent > Overall = Model improving! üéâ<br>
                            ‚Ä¢ Recent < Overall = Model regressing üòü<br>
                            ‚Ä¢ All similar = Model plateaued üìä<br>
                            <br>
                            Color coding: Green=improving, Yellow=stable, Red=regressing
                        </span>
                    </div>
                </h3>

                <div class="metric">
                    <span class="metric-label">Last 20 Evaluations
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Last 20 Evaluations</div>
                                Accuracy on the most recent 20 evaluation examples.
                                <br><br>
                                This shows <strong>short-term performance</strong> and reacts quickly to changes.
                                <br><br>
                                If significantly higher than overall: Model is improving!<br>
                                If significantly lower: May need to investigate
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="accuracy20">-% (-/-)</span>
                </div>

                <div class="metric">
                    <span class="metric-label">Last 50 Evaluations
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Last 50 Evaluations</div>
                                Accuracy on the most recent 50 evaluation examples.
                                <br><br>
                                This shows <strong>medium-term trend</strong> and is more stable than Last 20.
                                <br><br>
                                Good for seeing sustained improvement or issues
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="accuracy50">-% (-/-)</span>
                </div>

                <div class="metric">
                    <span class="metric-label">Trend Analysis
                        <div class="tooltip-icon inline">‚ÑπÔ∏è
                            <span class="tooltiptext">
                                <div class="tooltip-header">Trend Analysis</div>
                                Compares recent performance to overall average.
                                <br><br>
                                <strong>‚Üë Improving:</strong> Recent accuracy > overall (good!)<br>
                                <strong>‚Üí Stable:</strong> Recent ‚âà overall (plateaued)<br>
                                <strong>‚Üì Regressing:</strong> Recent < overall (investigate)
                            </span>
                        </div>
                    </span>
                    <span class="metric-value" id="accuracyTrend">-</span>
                </div>
            </div>
        </div>

        <!-- Current Example - All Four Components -->
        <div class="panel compactable">
            <h2>üîß System Prompt (Step <span id="currentExampleStep">-</span>)</h2>
            <div class="sample-box">
                <pre id="systemPrompt" style="color: #88ccff;">Waiting for validation step...</pre>
            </div>
        </div>

        <div class="panel compactable">
            <h2>üìù User Message</h2>
            <div class="sample-box">
                <pre id="prompt">Waiting for validation step...</pre>
            </div>
        </div>

        <div class="grid-2 compactable">
            <div class="panel">
                <h2>‚úÖ Expected (Golden Answer)</h2>
                <div class="sample-box">
                    <pre id="golden">Waiting for validation step...</pre>
                </div>
            </div>
            <div class="panel">
                <h2>ü§ñ Model Output<span id="matchBadge"></span></h2>
                <div class="sample-box">
                    <pre id="modelAnswer">Waiting for validation step...</pre>
                </div>
            </div>
        </div>

        <!-- Recent Examples History -->
        <div class="panel compactable">
            <h2>üìú Recent Evaluations (Model Outputs Only)</h2>
            <div id="recentExamples" style="font-size: 0.85em;">
                <p style="color: #888;">No model evaluations yet (waiting for next eval step)...</p>
            </div>
        </div>

        <div class="section-divider">üî¨ ANALYSIS & INSIGHTS</div>

        <div class="panel compactable">
            <h2>üß† Layer Adaptation Monitor
                <div class="tooltip-icon">‚ÑπÔ∏è
                    <span class="tooltiptext">
                        <div class="tooltip-header">Per-Layer Weight Changes</div>
                        Tracks how much each transformer block's weight norm changes between snapshots.
                        Useful for spotting dead layers or bursts of learning.
                    </span>
                </div>
            </h2>
            <div id="layerActivitySummary" style="color: #888; margin-bottom: 10px;">
                Waiting for first snapshot...
            </div>
            <div id="layerActivityTop" style="font-family: monospace; font-size: 0.85em; line-height: 1.6;"></div>
        </div>

    </div>


    <!-- ========================================
         MODULAR JAVASCRIPT - REFACTORED  
         All inline code (~1600 lines) extracted to clean modules
         ======================================== -->

    <!-- Core ES6 Modules -->
    <script type="module" src="/monitoring/js/main.js"></script>

    <!-- Existing modular files (keep for compatibility) -->
    <script src="/monitoring/js/monitor_metrics.js"></script>
    <script src="/monitoring/js/monitor_charts.js"></script>
    <script src="/monitoring/js/monitor_improvements.js"></script>

    <!-- Minimal global functions for inline HTML event handlers -->
    <script>
        // Global utility function for closing modals
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'none';
        }

        console.log('‚ö° Modular Training Monitor - Initializing...');
    </script>


    <!-- Load modular JS files (REFACTORED) -->
    <script src="/monitoring/js/monitor_metrics.js"></script>
    <script src="/monitoring/js/monitor_charts.js"></script>
    <script src="/monitoring/js/monitor_improvements.js"></script>
    <!-- Queue Preview Panel (Bottom, Fixed) -->
    <div id="queuePreviewPanel" style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(15, 23, 42, 0.98); border-top: 2px solid #00d9ff; max-height: 300px; overflow-y: auto; z-index: 100; display: none;">
        <div style="padding: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="margin: 0; color: #00d9ff; font-size: 1.1em;">üìã Queue Preview - Random Samples</h3>
                <button id="closeQueuePreview" style="padding: 5px 12px; background: rgba(255, 68, 68, 0.2); border: 1px solid #ff4444; color: #ff4444; border-radius: 5px; cursor: pointer;">‚úï Close</button>
            </div>
            <div id="queueSamplesContainer" style="display: flex; gap: 15px; overflow-x: auto; padding: 10px 0;">
                <!-- Samples will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Toggle button for queue preview -->
    <button id="toggleQueuePreview" style="position: fixed; bottom: 10px; right: 10px; padding: 10px 15px; background: rgba(0, 217, 255, 0.2); border: 2px solid #00d9ff; color: #00d9ff; border-radius: 8px; cursor: pointer; font-size: 0.9em; z-index: 99; display: none;">
        üëÅÔ∏è Preview Queue
    </button>

</body>
</html>
