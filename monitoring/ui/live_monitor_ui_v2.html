<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Monitor - Enhanced</title>
    <link rel="stylesheet" href="/monitoring/css/live_monitor.css">
</head>
<body>
    <!-- TOP STATUS BAR -->
    <div id="statusBar" class="status-bar">
        <div class="health-indicator">
            <div class="health-dot" id="healthDot"></div>
            <span id="healthLabel">INITIALIZING</span>
        </div>
        <div class="metric-group">
            <div class="metric">
                <span class="label">Step</span>
                <span class="value" id="currentStep">--</span>
            </div>
            <div class="metric">
                <span class="label">Model</span>
                <span class="value" id="currentModelName">--</span>
            </div>
            <div class="metric">
                <span class="label">Loss</span>
                <span class="value" id="currentLoss">--</span>
            </div>
            <div class="metric">
                <span class="label">Val Loss</span>
                <span class="value" id="valLoss">--</span>
            </div>
            <div class="metric">
                <span class="label">Gap</span>
                <span class="value" id="lossGap">--</span>
            </div>
            <div class="metric">
                <span class="label">Think Tags</span>
                <span class="value" id="thinkPct">--</span>
            </div>
            <div class="metric">
                <span class="label">Accuracy</span>
                <span class="value" id="accuracy">--</span>
            </div>
            <div class="metric">
                <span class="label">Queue</span>
                <span class="value" id="queueSize">--</span>
            </div>
        </div>
        <div class="nav-links">
            <a href="/monitoring/ui/systems_dashboard.html" class="nav-link" title="View all autonomous monitoring systems">
                Systems Dashboard
            </a>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="container">
        <!-- LEFT PANEL: Prompt/Response Viewer -->
        <div class="panel panel-main">
            <div class="panel-header">
                <h2>üéØ Current Training Example</h2>
                <div class="step-indicator">Step <span id="exampleStep">--</span></div>
            </div>

            <!-- System Prompt -->
            <div class="section system-prompt">
                <div class="section-header">
                    <span>üìã System Prompt</span>
                    <button class="btn-collapse" onclick="toggleSection('systemPrompt')">‚àí</button>
                </div>
                <div id="systemPrompt" class="content-box">
                    <pre id="systemPromptText">Loading...</pre>
                </div>
            </div>

            <!-- User Prompt -->
            <div class="section user-prompt">
                <div class="section-header">
                    <span>üí¨ User Prompt</span>
                    <button class="btn-expand" onclick="expandPrompt()">üîç Expand</button>
                </div>
                <div class="content-box">
                    <pre id="userPromptText">Loading...</pre>
                </div>
            </div>

            <!-- Response Comparison -->
            <div class="section response-comparison">
                <div class="section-header">
                    <span>üéØ Response Comparison</span>
                    <div class="match-indicator" id="matchIndicator">--</div>
                </div>
                <div class="split-view">
                    <div class="response-panel golden">
                        <div class="response-label">‚úÖ Golden Answer</div>
                        <div class="content-box">
                            <pre id="goldenAnswer">Loading...</pre>
                        </div>
                    </div>
                    <div class="response-panel model">
                        <div class="response-label">ü§ñ Model Output</div>
                        <div class="content-box">
                            <pre id="modelAnswer">Loading...</pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Metrics for this example -->
            <div class="example-metrics">
                <div class="metric-card">
                    <span class="metric-label">Loss</span>
                    <span class="metric-value" id="exampleLoss">--</span>
                </div>
                <div class="metric-card">
                    <span class="metric-label">Has Think Tags</span>
                    <span class="metric-value" id="exampleHasThink">--</span>
                </div>
                <div class="metric-card">
                    <span class="metric-label">Length</span>
                    <span class="metric-value" id="exampleLength">--</span>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL: Charts & Data Browser -->
        <div class="panel panel-sidebar">
            <!-- Validation Charts -->
            <div class="chart-section">
                <h3>üìä Training vs Validation</h3>
                <canvas id="lossChart"></canvas>
            </div>

            <div class="chart-section">
                <h3>ü§î Think Tag Percentage</h3>
                <canvas id="thinkTagChart"></canvas>
            </div>

            <!-- Training Data Browser -->
            <div class="data-browser">
                <h3>üìÅ Training Data Browser</h3>
                <div class="file-info">
                    <div class="info-row">
                        <span class="label">Current File:</span>
                        <span id="currentFile">--</span>
                    </div>
                    <div class="info-row">
                        <span class="label">File Progress:</span>
                        <span id="fileProgress">-- / --</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Files in Queue:</span>
                        <span id="queueCount" style="font-weight: bold;">--</span>
                    </div>
                </div>
                <button class="btn-primary" onclick="openDataBrowser()">
                    üîç Browse Training Examples
                </button>
            </div>

            <!-- Recent Examples -->
            <div class="recent-examples">
                <h3>üìú Recent Examples</h3>
                <div id="recentList"></div>
                <button class="btn-primary" style="margin-top: 10px;" onclick="openHistoryLog()">
                    üìÇ Open Inference History (Last 10)
                </button>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <!-- Expanded Prompt Modal -->
    <div id="expandModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üîç Detailed View - Step <span id="modalStep">--</span></h2>
                <button class="modal-close" onclick="closeModal('expandModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div id="expandedContent"></div>
            </div>
        </div>
    </div>

    <!-- Training Data Browser Modal -->
    <div id="dataBrowserModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üìÅ Training Data Browser</h2>
                <button class="modal-close" onclick="closeModal('dataBrowserModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="browser-controls">
                    <input type="text" id="searchExamples" placeholder="Search examples..." class="search-box">
                    <select id="filterPattern" class="filter-select">
                        <option value="all">All Patterns</option>
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                <div id="examplesList" class="examples-list"></div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/monitoring/js/chart_manager.js"></script>
    <script src="/monitoring/js/metrics_display.js"></script>
    <script src="/monitoring/js/data_browser.js"></script>
    <script src="/monitoring/js/live_monitor.js"></script>
    <script src="/monitoring/js/history_viewer.js"></script>
</body>
</html>
