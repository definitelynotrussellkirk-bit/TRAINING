<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Monitoring Dashboard</title>
    <link rel="stylesheet" href="/css/master_dashboard.css">
</head>
<body>
    <!-- ERROR ALERT CARDS CONTAINER -->
    <div id="errorCardsContainer" class="error-cards-container">
        <!-- Error cards will be dynamically inserted here -->
    </div>

    <!-- TOP STATUS BAR -->
    <header class="master-header">
        <div class="header-left">
            <h1 class="master-title">‚ö° Master Monitoring Dashboard</h1>
            <div class="system-health">
                <div class="health-dot" id="systemHealthDot"></div>
                <span id="systemHealthLabel">INITIALIZING</span>
            </div>
            <!-- Daemon Status Badge with Dropdown -->
            <div class="daemon-status-wrapper" id="daemonStatusWrapper">
                <button class="daemon-status-badge" id="daemonStatusBadge" onclick="toggleDaemonDropdown()">
                    <span class="daemon-badge-icon" id="daemonBadgeIcon">‚è≥</span>
                    <span class="daemon-badge-text" id="daemonBadgeText">Loading...</span>
                </button>
                <div class="daemon-dropdown" id="daemonDropdown">
                    <div class="daemon-dropdown-header">
                        <span>Daemon Status</span>
                        <button class="daemon-dropdown-close" onclick="toggleDaemonDropdown()">√ó</button>
                    </div>
                    <div class="daemon-dropdown-content" id="daemonDropdownContent">
                        <!-- Daemon list will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="header-center">
            <div class="quick-metric">
                <span class="quick-label" data-tooltip="Current training step number">Training</span>
                <span class="quick-value" id="quickTrainingStep">--</span>
            </div>
            <div class="quick-metric">
                <span class="quick-label" data-tooltip="Current training loss - lower is better">Loss</span>
                <span class="quick-value" id="quickLoss">--</span>
            </div>
            <div class="quick-metric">
                <span class="quick-label" data-tooltip="4090 GPU memory usage percentage">4090 VRAM</span>
                <span class="quick-value" id="quick4090VRAM">--</span>
            </div>
            <div class="quick-metric">
                <span class="quick-label" data-tooltip="3090 GPU memory usage percentage">3090 VRAM</span>
                <span class="quick-value" id="quick3090VRAM">--</span>
            </div>
            <div class="quick-metric">
                <span class="quick-label" data-tooltip="Healthy data sources / total data sources">Plugins</span>
                <span class="quick-value" id="quickPlugins">--</span>
            </div>
        </div>

        <div class="header-right">
            <div class="update-time">Last Update: <span id="lastUpdate">--</span></div>
            <div class="refresh-indicator" id="refreshIndicator">‚óè</div>
        </div>
    </header>

    <!-- MAIN GRID -->
    <div class="master-grid">
        <!-- LEFT COLUMN: TRAINING MACHINE (4090) -->
        <div class="column column-left">
            <div class="column-header">
                <h2>üöÄ RTX 4090 - Training Machine</h2>
                <div class="machine-badge machine-4090">LOCAL</div>
            </div>

            <!-- Training Status Card -->
            <div class="card card-training">
                <div class="card-header">
                    <h3>üìä Training Status</h3>
                    <div class="status-indicator" id="trainingStatusIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="metric-grid">
                        <div class="metric-item">
                            <span class="metric-label" data-tooltip="Current training state: training, paused, stopped, or idle">Status</span>
                            <span class="metric-value" id="trainingStatus">--</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label" data-tooltip="Current step / total steps in the training run. Each step processes one batch of data.">Step</span>
                            <span class="metric-value" id="trainingStep">-- / --</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label" data-tooltip="Percentage of training completed (current_step / total_steps √ó 100)">Progress</span>
                            <span class="metric-value" id="trainingProgress">--%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label" data-tooltip="Training loss - measures how wrong predictions are. Lower is better. Target: < 0.5">Loss</span>
                            <span class="metric-value metric-highlight" id="trainingLoss">--</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label" data-tooltip="Validation loss - loss on held-out data. Should track training loss. If higher, model may be overfitting.">Val Loss</span>
                            <span class="metric-value" id="trainingValLoss">--</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label" data-tooltip="Val-Train gap: difference between validation and training loss. < 0.3 = good, > 0.5 = overfitting risk">Gap</span>
                            <span class="metric-value" id="trainingGap">--</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label" data-tooltip="Token prediction accuracy on validation set. Higher is better. Measures exact token match rate.">Accuracy</span>
                            <span class="metric-value" id="trainingAccuracy">--%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label" data-tooltip="Training throughput - tokens processed per second. Higher = faster training.">Tokens/sec</span>
                            <span class="metric-value" id="trainingTokens">--</span>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="trainingProgressBar"></div>
                    </div>
                    <div class="action-hint" id="trainingAction">Loading training status...</div>
                </div>
            </div>

            <!-- Training Queue Card (Interactive) -->
            <div class="card card-queue">
                <div class="card-header">
                    <h3>üì¶ Training Queue</h3>
                    <button onclick="refreshQueue()" class="refresh-btn">‚Üª</button>
                </div>
                <div class="card-body">
                    <div class="queue-summary">
                        <div class="queue-stat-mini">
                            <span class="queue-val" id="queueTotalFiles">--</span>
                            <span class="queue-lbl">Files</span>
                        </div>
                        <div class="queue-stat-mini">
                            <span class="queue-val" id="queueTotalExamples">--</span>
                            <span class="queue-lbl">Examples</span>
                        </div>
                        <div class="queue-stat-mini">
                            <span class="queue-val" id="queueInboxCount">--</span>
                            <span class="queue-lbl">Inbox</span>
                        </div>
                    </div>
                    <div class="queue-tabs">
                        <button class="q-tab active" data-priority="all" onclick="filterQueueMain('all')">All</button>
                        <button class="q-tab" data-priority="high" onclick="filterQueueMain('high')">üî¥ <span id="qCountHigh">0</span></button>
                        <button class="q-tab" data-priority="normal" onclick="filterQueueMain('normal')">üü° <span id="qCountNormal">0</span></button>
                        <button class="q-tab" data-priority="low" onclick="filterQueueMain('low')">üü¢ <span id="qCountLow">0</span></button>
                    </div>
                    <div id="queueFileList" class="queue-file-list">
                        <div class="queue-loading">Loading...</div>
                    </div>
                    <div id="queueEmptyState" class="queue-empty" style="display: none;">
                        üì≠ Queue empty
                    </div>
                </div>
            </div>

            <!-- GPU 4090 Card -->
            <div class="card card-gpu">
                <div class="card-header">
                    <h3>üéÆ GPU 4090 Statistics</h3>
                    <div class="status-indicator" id="gpu4090Indicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="gpu-metrics">
                        <div class="gpu-stat">
                            <span class="gpu-label" data-tooltip="GPU memory currently allocated for training. Approaches 24GB during training batches.">VRAM Used</span>
                            <span class="gpu-value" id="gpu4090VRAMUsed">-- GB</span>
                        </div>
                        <div class="gpu-stat">
                            <span class="gpu-label" data-tooltip="Total GPU memory available. RTX 4090 has 24GB VRAM.">VRAM Total</span>
                            <span class="gpu-value" id="gpu4090VRAMTotal">-- GB</span>
                        </div>
                        <div class="gpu-stat">
                            <span class="gpu-label" data-tooltip="GPU compute utilization percentage. Should be >90% during active training.">Utilization</span>
                            <span class="gpu-value" id="gpu4090Util">--%</span>
                        </div>
                        <div class="gpu-stat">
                            <span class="gpu-label" data-tooltip="GPU temperature in Celsius. Safe range: <80¬∞C. Throttling may occur >85¬∞C.">Temperature</span>
                            <span class="gpu-value" id="gpu4090Temp">--¬∞C</span>
                        </div>
                    </div>
                    <div class="vram-bar-container">
                        <div class="vram-bar" id="vram4090Bar"></div>
                        <span class="vram-label" id="vram4090Label">-- %</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- CENTER COLUMN: INTELLIGENCE SYSTEMS 1 (3090) -->
        <div class="column column-center">
            <div class="column-header">
                <h2>üß† RTX 3090 - Intelligence Systems</h2>
                <div class="machine-badge machine-3090">REMOTE</div>
            </div>

            <!-- Curriculum Optimization Card -->
            <div class="card card-intelligence">
                <div class="card-header">
                    <h3>üìö Curriculum & Data Flow</h3>
                    <div class="status-indicator" id="curriculumIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <!-- Data Flow Section -->
                    <div class="data-flow-section">
                        <div class="data-flow-skills">
                            <div class="skill-flow" id="sylloFlowCard">
                                <div class="skill-flow-header">
                                    <span class="skill-flow-name">üß© SYLLO</span>
                                    <span class="skill-flow-level" id="sylloFlowLevel">L1/5</span>
                                </div>
                                <div class="skill-flow-bar">
                                    <div class="skill-flow-progress" id="sylloFlowProgress" style="width: 0%"></div>
                                </div>
                                <div class="skill-flow-meta">
                                    <span id="sylloFlowAcc">0%</span>
                                    <span class="skill-flow-trend" id="sylloFlowTrend">‚Üí</span>
                                    <span id="sylloFlowEvals">0 evals</span>
                                </div>
                            </div>
                            <div class="skill-flow inactive" id="binaryFlowCard">
                                <div class="skill-flow-header">
                                    <span class="skill-flow-name">‚ì™‚ë† BINARY</span>
                                    <span class="skill-flow-level" id="binaryFlowLevel">L1/7</span>
                                </div>
                                <div class="skill-flow-bar">
                                    <div class="skill-flow-progress" id="binaryFlowProgress" style="width: 0%"></div>
                                </div>
                                <div class="skill-flow-meta">
                                    <span id="binaryFlowAcc">0%</span>
                                    <span class="skill-flow-trend" id="binaryFlowTrend">‚Üí</span>
                                    <span id="binaryFlowEvals">0 evals</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Legacy Accuracy Display -->
                    <div class="intel-metrics" style="margin-top: 0.5rem;">
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Model accuracy on easy difficulty problems. Target: >80%.">Easy</span>
                            <span class="intel-value intel-easy" id="curriculumEasy">--%</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Model accuracy on medium difficulty problems. Target: >70%.">Med</span>
                            <span class="intel-value intel-medium" id="curriculumMedium">--%</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Model accuracy on hard difficulty problems. Target: >60%.">Hard</span>
                            <span class="intel-value intel-hard" id="curriculumHard">--%</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Training step at which this evaluation was performed.">Step</span>
                            <span class="intel-value" id="curriculumStep">--</span>
                        </div>
                    </div>
                    <div class="action-hint" id="curriculumAction">Loading curriculum data...</div>
                </div>
            </div>

            <!-- Regression Monitoring Card -->
            <div class="card card-intelligence">
                <div class="card-header">
                    <h3>‚ö†Ô∏è Regression Monitoring</h3>
                    <div class="status-indicator" id="regressionIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="intel-metrics">
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="YES if current checkpoint performs worse than previous. Triggers alert for investigation.">Regression Detected</span>
                            <span class="intel-value" id="regressionDetected">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Percentage increase in loss compared to best checkpoint. >15% = significant regression.">Loss Increase</span>
                            <span class="intel-value" id="regressionLossInc">--%</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Percentage decrease in accuracy compared to best checkpoint.">Accuracy Drop</span>
                            <span class="intel-value" id="regressionAccDrop">--%</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Total number of regressions detected during this training run.">Total Regressions</span>
                            <span class="intel-value" id="regressionTotal">--</span>
                        </div>
                    </div>
                    <div class="action-hint" id="regressionAction">Loading regression data...</div>
                </div>
            </div>

            <!-- Model Comparison Card -->
            <div class="card card-intelligence">
                <div class="card-header">
                    <h3>üèÜ Model Comparison</h3>
                    <div class="status-indicator" id="modelCompIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="intel-metrics">
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Checkpoint with the highest composite score (loss + accuracy + inference speed).">Best Checkpoint</span>
                            <span class="intel-value" id="modelCompBest">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Composite quality score (0-1). Higher is better. Combines loss, accuracy, and throughput.">Best Score</span>
                            <span class="intel-value" id="modelCompScore">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Total number of checkpoints evaluated and ranked.">Checkpoints Compared</span>
                            <span class="intel-value" id="modelCompTotal">--</span>
                        </div>
                    </div>
                    <div class="top-models" id="topModelsContainer">
                        <!-- Top 3 models will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Automated Testing Card -->
            <div class="card card-intelligence">
                <div class="card-header">
                    <h3>‚úÖ Automated Testing</h3>
                    <div class="status-indicator" id="testingIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="intel-metrics">
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Percentage of validation tests passed. Target: >70%. Measures real-world task completion.">Pass Rate</span>
                            <span class="intel-value" id="testingPassRate">--%</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Total number of test cases in the fixed validation suite.">Total Tests</span>
                            <span class="intel-value" id="testingTotal">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Number of tests where model output matched expected answer.">Passed</span>
                            <span class="intel-value intel-good" id="testingPassed">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Number of tests where model output did not match expected answer.">Failed</span>
                            <span class="intel-value intel-bad" id="testingFailed">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Version Selector for Skills -->
            <div class="skill-version-selector" style="margin-bottom: 1rem; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 4px; display: flex; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
                <label style="font-size: 0.9rem;">Compare version:</label>
                <select id="skillVersionSelect" style="background: #2a2a2a; color: #e0e0e0; border: 1px solid #444; padding: 0.3rem 0.5rem; border-radius: 4px; min-width: 220px;">
                    <option value="">Loading...</option>
                </select>
                <span id="skillVersionInfo" style="font-size: 0.8rem; color: #888;"></span>
                <span id="skillCheckpointInfo" style="font-size: 0.8rem; color: #4fc3f7; background: rgba(79,195,247,0.1); padding: 0.2rem 0.5rem; border-radius: 3px; display: none;"></span>
            </div>

            <!-- SYLLABLE Skill Card -->
            <div class="card card-skill">
                <div class="card-header">
                    <h3><a href="/ui/syllo_dashboard.html" style="color: inherit; text-decoration: none;">üß© SYLLABLE Skill</a></h3>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <a href="/ui/syllo_dashboard.html" class="detail-link" style="font-size: 0.75rem; color: #a855f7; text-decoration: none;">Details ‚Üí</a>
                        <div class="status-indicator" id="syllableIndicator">‚óè</div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="skill-overview">
                        <div class="skill-accuracy-large">
                            <span class="accuracy-value" id="syllableOverall">--%</span>
                            <span class="accuracy-label">Overall Accuracy</span>
                        </div>
                        <div class="skill-delta" id="syllableDelta">
                            <span class="delta-arrow">‚Üë</span>
                            <span class="delta-value">--</span>
                            <span class="delta-label" data-tooltip="Improvement over base model (Qwen3-0.6B untrained)">vs base</span>
                        </div>
                    </div>
                    <div class="skill-difficulty-bars">
                        <div class="difficulty-row">
                            <span class="diff-label" data-tooltip="4-5 word puzzles, unique syllables, no red herrings">Easy</span>
                            <div class="diff-bar-container">
                                <div class="diff-bar diff-easy" id="syllableEasyBar" style="width: 0%"></div>
                            </div>
                            <span class="diff-value" id="syllableEasy">--%</span>
                        </div>
                        <div class="difficulty-row">
                            <span class="diff-label" data-tooltip="5-6 word puzzles, some overlap, 1-2 red herrings">Medium</span>
                            <div class="diff-bar-container">
                                <div class="diff-bar diff-medium" id="syllableMediumBar" style="width: 0%"></div>
                            </div>
                            <span class="diff-value" id="syllableMedium">--%</span>
                        </div>
                        <div class="difficulty-row">
                            <span class="diff-label" data-tooltip="6-8 word puzzles, high overlap, 3-5 red herrings">Hard</span>
                            <div class="diff-bar-container">
                                <div class="diff-bar diff-hard" id="syllableHardBar" style="width: 0%"></div>
                            </div>
                            <span class="diff-value" id="syllableHard">--%</span>
                        </div>
                    </div>
                    <div class="skill-meta">
                        <span class="meta-item" data-tooltip="When this skill was last evaluated">Last eval: <span id="syllableLastEval">--</span></span>
                    </div>
                </div>
            </div>

            <!-- BINARY Skill Card -->
            <div class="card card-skill">
                <div class="card-header">
                    <h3>‚ì™‚ë† BINARY Skill</h3>
                    <div class="status-indicator" id="binaryIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="skill-overview">
                        <div class="skill-accuracy-large">
                            <span class="accuracy-value" id="binaryOverall">--%</span>
                            <span class="accuracy-label">Overall Accuracy</span>
                        </div>
                        <div class="skill-delta" id="binaryDelta">
                            <span class="delta-arrow">‚Üë</span>
                            <span class="delta-value">--</span>
                            <span class="delta-label" data-tooltip="Improvement over base model (Qwen3-0.6B untrained)">vs base</span>
                        </div>
                    </div>
                    <div class="skill-difficulty-bars">
                        <div class="difficulty-row">
                            <span class="diff-label" data-tooltip="Basic operations: add, subtract, conversions with small numbers">Easy</span>
                            <div class="diff-bar-container">
                                <div class="diff-bar diff-easy" id="binaryEasyBar" style="width: 0%"></div>
                            </div>
                            <span class="diff-value" id="binaryEasy">--%</span>
                        </div>
                        <div class="difficulty-row">
                            <span class="diff-label" data-tooltip="Chained operations, carry/borrow propagation, shifts">Medium</span>
                            <div class="diff-bar-container">
                                <div class="diff-bar diff-medium" id="binaryMediumBar" style="width: 0%"></div>
                            </div>
                            <span class="diff-value" id="binaryMedium">--%</span>
                        </div>
                        <div class="difficulty-row">
                            <span class="diff-label" data-tooltip="Large numbers, complex chains, pattern recognition">Hard</span>
                            <div class="diff-bar-container">
                                <div class="diff-bar diff-hard" id="binaryHardBar" style="width: 0%"></div>
                            </div>
                            <span class="diff-value" id="binaryHard">--%</span>
                        </div>
                    </div>
                    <div class="skill-meta">
                        <span class="meta-item" data-tooltip="When this skill was last evaluated">Last eval: <span id="binaryLastEval">--</span></span>
                    </div>
                </div>
            </div>

            <!-- Transfer Learning Summary Card -->
            <div class="card card-intelligence" id="transferCard">
                <div class="card-header">
                    <h3>üß¨ Transfer Learning</h3>
                    <div class="status-indicator" id="transferIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <p style="font-size: 0.75rem; color: #888; margin-bottom: 0.5rem;">
                        Does training on syllables/binary help or hurt other skills?
                    </p>
                    <div class="transfer-summary" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem;">
                        <!-- Primitives -->
                        <div class="transfer-category" style="text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 4px;">
                            <div style="font-size: 0.7rem; color: #888; margin-bottom: 0.2rem;">Primitives (26)</div>
                            <div id="primitivesAvg" style="font-size: 1.2rem; font-weight: bold;">--</div>
                            <div id="primitivesDelta" style="font-size: 0.8rem; color: #888;">vs base</div>
                        </div>
                        <!-- bAbI -->
                        <div class="transfer-category" style="text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 4px;">
                            <div style="font-size: 0.7rem; color: #888; margin-bottom: 0.2rem;">bAbI (20)</div>
                            <div id="babiAvg" style="font-size: 1.2rem; font-weight: bold;">--</div>
                            <div id="babiDelta" style="font-size: 0.8rem; color: #888;">vs base</div>
                        </div>
                        <!-- BIG-Bench -->
                        <div class="transfer-category" style="text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 4px;">
                            <div style="font-size: 0.7rem; color: #888; margin-bottom: 0.2rem;">BIG-Bench</div>
                            <div id="bigbenchAvg" style="font-size: 1.2rem; font-weight: bold;">--</div>
                            <div id="bigbenchDelta" style="font-size: 0.8rem; color: #888;">vs base</div>
                        </div>
                    </div>
                    <div id="transferDetails" style="margin-top: 0.5rem; font-size: 0.75rem; color: #666; max-height: 100px; overflow-y: auto;">
                        <!-- Best/worst performers will be shown here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: INTELLIGENCE SYSTEMS 2 (3090) -->
        <div class="column column-right">
            <div class="column-header">
                <h2>üî¨ More Intelligence & Hardware</h2>
            </div>

            <!-- Adversarial Mining Card -->
            <div class="card card-intelligence">
                <div class="card-header">
                    <h3>üíÄ Adversarial Mining</h3>
                    <div class="status-indicator" id="advIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="intel-metrics">
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Hard examples mined from model failures. These get added to training to improve weak areas.">Total Examples</span>
                            <span class="intel-value" id="advTotal">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Number of failure categories identified (e.g., math errors, logic gaps, format issues).">Categories</span>
                            <span class="intel-value" id="advCategories">--</span>
                        </div>
                    </div>
                    <div class="adv-categories" id="advCategoriesContainer">
                        <!-- Categories will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Confidence Calibration Card -->
            <div class="card card-intelligence">
                <div class="card-header">
                    <h3>üìà Confidence Calibration</h3>
                    <div class="status-indicator" id="confIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="intel-metrics">
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Expected Calibration Error - measures if model confidence matches actual accuracy. Lower is better. <0.1 = well calibrated.">ECE</span>
                            <span class="intel-value" id="confECE">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Number of confidence bins used for calibration analysis (typically 6-10).">Bins</span>
                            <span class="intel-value" id="confBins">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Proportion of predictions where confidence exceeds accuracy. High = model is overconfident.">Overconfidence</span>
                            <span class="intel-value" id="confOverconf">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Self-Correction Loop Card -->
            <div class="card card-intelligence">
                <div class="card-header">
                    <h3>üîÑ Self-Correction Loop</h3>
                    <div class="status-indicator" id="selfCorrIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="intel-metrics">
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Number of model errors collected for analysis. Used to identify systematic failure patterns.">Errors Captured</span>
                            <span class="intel-value" id="selfCorrErrors">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Distinct error patterns identified (e.g., 'forgets stop token', 'wrong JSON format').">Patterns Found</span>
                            <span class="intel-value" id="selfCorrPatterns">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Correction examples generated this session. These are targeted training data to fix errors.">Corrections Gen</span>
                            <span class="intel-value" id="selfCorrGen">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Total correction examples generated across all sessions.">Total Corrections</span>
                            <span class="intel-value" id="selfCorrTotal">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Checkpoint Sync Card -->
            <div class="card card-intelligence">
                <div class="card-header">
                    <h3>üîÑ Checkpoint Sync</h3>
                    <div class="status-indicator" id="checkpointIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="intel-metrics">
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Current sync status: syncing, idle, error. Checkpoints transfer from 4090 to 3090 for evaluation.">Sync Status</span>
                            <span class="intel-value" id="checkpointStatus">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Most recent checkpoint synced to 3090 for evaluation/deployment.">Latest Checkpoint</span>
                            <span class="intel-value" id="checkpointLatest">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Total number of checkpoints successfully synced to 3090.">Total Synced</span>
                            <span class="intel-value" id="checkpointSynced">--</span>
                        </div>
                        <div class="intel-stat">
                            <span class="intel-label" data-tooltip="Number of sync failures (network issues, disk full, etc.).">Failures</span>
                            <span class="intel-value" id="checkpointFailures">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Layer Drift Analysis Card -->
            <div class="card card-analytics">
                <div class="card-header">
                    <h3>üìä Layer Drift Analysis</h3>
                    <div class="status-indicator" id="layerDriftIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="drift-summary">
                        <div class="drift-metric">
                            <span class="drift-label" data-tooltip="Total weight change vs base model. Higher = more learning.">Total Change</span>
                            <span class="drift-value" id="driftTotalChange">--</span>
                        </div>
                        <div class="drift-metric">
                            <span class="drift-label" data-tooltip="Change distribution: 'uniform'=all layers, 'top_heavy'=mostly top layers, 'bottom_heavy'=mostly bottom layers">Pattern</span>
                            <span class="drift-value" id="driftPattern">--</span>
                        </div>
                        <div class="drift-metric">
                            <span class="drift-label" data-tooltip="Layer with most weight change - where task-specific features form">Max Drift</span>
                            <span class="drift-value" id="driftMaxLayer">--</span>
                        </div>
                    </div>
                    <div class="drift-comparison">
                        <span class="drift-ref" id="driftRef">-- vs --</span>
                    </div>
                    <div class="layer-drift-chart" id="layerDriftChart">
                        <!-- 28 layer bars will be injected here by JS -->
                    </div>
                    <div class="drift-legend">
                        <span class="legend-item"><span class="legend-color low"></span>&lt;20%</span>
                        <span class="legend-item"><span class="legend-color medium"></span>20-35%</span>
                        <span class="legend-item"><span class="legend-color high"></span>&gt;35%</span>
                    </div>
                </div>
            </div>

            <!-- Parameter Stability Card -->
            <div class="card card-analytics">
                <div class="card-header">
                    <h3>‚öñÔ∏è Parameter Stability</h3>
                    <div class="status-indicator" id="paramStabilityIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="stability-summary">
                        <div class="stability-metric">
                            <span class="stability-label" data-tooltip="Overall health: 'healthy'=no issues, 'warning'=minor concerns, 'critical'=action needed">Health</span>
                            <span class="stability-value" id="stabilityHealth">--</span>
                        </div>
                        <div class="stability-metric">
                            <span class="stability-label" data-tooltip="Average L2 norm of weights across all transformer layers">Avg Norm</span>
                            <span class="stability-value" id="stabilityAvgNorm">--</span>
                        </div>
                        <div class="stability-metric">
                            <span class="stability-label" data-tooltip="Number of stability alerts (exploding/vanishing weights)">Alerts</span>
                            <span class="stability-value" id="stabilityAlerts">--</span>
                        </div>
                    </div>
                    <div class="stability-alerts" id="stabilityAlertsContainer">
                        <!-- Alerts will be injected here by JS -->
                    </div>
                    <div class="layer-norms-chart" id="layerNormsChart">
                        <!-- Norm bars will be injected here by JS -->
                    </div>
                </div>
            </div>

            <!-- GPU 3090 Card -->
            <div class="card card-gpu">
                <div class="card-header">
                    <h3>üéÆ GPU 3090 Statistics</h3>
                    <div class="status-indicator" id="gpu3090Indicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="gpu-metrics">
                        <div class="gpu-stat">
                            <span class="gpu-label" data-tooltip="GPU memory used for inference server. Typically ~2GB for loaded model.">VRAM Used</span>
                            <span class="gpu-value" id="gpu3090VRAMUsed">-- GB</span>
                        </div>
                        <div class="gpu-stat">
                            <span class="gpu-label" data-tooltip="Total GPU memory available. RTX 3090 has 24GB VRAM.">VRAM Total</span>
                            <span class="gpu-value" id="gpu3090VRAMTotal">-- GB</span>
                        </div>
                        <div class="gpu-stat">
                            <span class="gpu-label" data-tooltip="GPU compute utilization. Spikes during inference requests, low when idle.">Utilization</span>
                            <span class="gpu-value" id="gpu3090Util">--%</span>
                        </div>
                        <div class="gpu-stat">
                            <span class="gpu-label" data-tooltip="GPU temperature in Celsius. Should stay below 80¬∞C for optimal performance.">Temperature</span>
                            <span class="gpu-value" id="gpu3090Temp">--¬∞C</span>
                        </div>
                    </div>
                    <div class="vram-bar-container">
                        <div class="vram-bar" id="vram3090Bar"></div>
                        <span class="vram-label" id="vram3090Label">-- %</span>
                    </div>
                </div>
            </div>

            <!-- GPU Task Scheduler Card -->
            <div class="card card-scheduler">
                <div class="card-header">
                    <h3>üéõÔ∏è GPU Task Scheduler</h3>
                    <div class="status-indicator" id="schedulerIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="scheduler-metrics">
                        <div class="scheduler-stat">
                            <span class="scheduler-label" data-tooltip="Tasks waiting in queue. Higher = busier scheduler.">Queue</span>
                            <span class="scheduler-value" id="schedulerQueue">--</span>
                        </div>
                        <div class="scheduler-stat">
                            <span class="scheduler-label" data-tooltip="Currently executing task type (eval, test, adversarial, etc.)">Active Task</span>
                            <span class="scheduler-value" id="schedulerActiveTask">--</span>
                        </div>
                        <div class="scheduler-stat">
                            <span class="scheduler-label" data-tooltip="GPU utilization. Target: 20-80%. Red if outside band.">GPU Util</span>
                            <span class="scheduler-value" id="schedulerGpuUtil">--%</span>
                        </div>
                        <div class="scheduler-stat">
                            <span class="scheduler-label" data-tooltip="Tasks completed since scheduler started.">Completed</span>
                            <span class="scheduler-value" id="schedulerCompleted">--</span>
                        </div>
                    </div>
                    <div class="scheduler-band" id="schedulerBandStatus">
                        <span class="band-indicator"></span>
                        <span class="band-text">Loading...</span>
                    </div>
                    <div class="action-hint" id="schedulerAction">Loading scheduler status...</div>
                </div>
            </div>

            <!-- Storage & Retention Card -->
            <div class="card card-retention">
                <div class="card-header">
                    <h3>üíæ Storage & Retention</h3>
                    <div class="status-indicator" id="retentionIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <div class="retention-metrics">
                        <div class="retention-stat">
                            <span class="retention-label" data-tooltip="Disk usage for checkpoints. Warning at >80%.">Usage</span>
                            <span class="retention-value" id="retentionUsage">--%</span>
                        </div>
                        <div class="retention-stat">
                            <span class="retention-label" data-tooltip="Number of checkpoints stored locally.">Checkpoints</span>
                            <span class="retention-value" id="retentionCheckpoints">--</span>
                        </div>
                        <div class="retention-stat">
                            <span class="retention-label" data-tooltip="Number of daily snapshots stored.">Snapshots</span>
                            <span class="retention-value" id="retentionSnapshots">--</span>
                        </div>
                    </div>
                    <div class="retention-bar-container">
                        <div class="retention-bar" id="retentionBar"></div>
                        <span class="retention-bar-label" id="retentionBarLabel">-- / -- GB</span>
                    </div>
                    <div class="retention-warnings" id="retentionWarnings">
                        <!-- Warnings will be inserted here -->
                    </div>
                    <div class="action-hint" id="retentionAction">Loading retention status...</div>
                </div>
            </div>

            <!-- Data File Impact Card -->
            <div class="card card-data-impact">
                <div class="card-header">
                    <h3>üìä Data File Impact</h3>
                    <div class="status-indicator" id="dataImpactIndicator">‚óè</div>
                </div>
                <div class="card-body">
                    <p class="card-subtitle">Which training files help vs hurt?</p>
                    <div class="impact-columns">
                        <div class="impact-column impact-positive">
                            <h4>‚úÖ Top Positive</h4>
                            <ul id="positiveImpactFiles">
                                <li class="impact-loading">Loading...</li>
                            </ul>
                        </div>
                        <div class="impact-column impact-negative">
                            <h4>‚ùå Top Negative</h4>
                            <ul id="negativeImpactFiles">
                                <li class="impact-loading">Loading...</li>
                            </ul>
                        </div>
                    </div>
                    <div class="action-hint" id="dataImpactAction">Analyzing data file impact...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER: API INFO -->
    <footer class="master-footer">
        <div class="api-info">
            <span>API: <code>http://localhost:8081/api/unified</code></span>
            <span class="divider">|</span>
            <span>Auto-refresh: <span id="refreshRate">5s</span></span>
            <span class="divider">|</span>
            <span>Data Sources: <span id="dataSourceCount">13</span></span>
        </div>
        <div class="footer-links">
            <a href="syllo_dashboard.html" class="footer-link">Syllo Dashboard</a>
            <a href="predictions.html" class="footer-link">Predictions</a>
            <a href="test_api.html" class="footer-link">Test API</a>
            <a href="/api/unified" target="_blank" class="footer-link">Raw JSON</a>
        </div>
    </footer>

    <script src="/js/master_dashboard.js"></script>
</body>
</html>
