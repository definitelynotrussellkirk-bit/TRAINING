════════════════════════════════════════════════════════════════════════════
DIRECTORY CLEANUP REPORT
Date: 2025-11-22
════════════════════════════════════════════════════════════════════════════

CLEANUP COMPLETED
────────────────────────────────────────────────────────────────────────────
✅ Deleted 200+ empty directories
   - Mostly empty evolution_snapshots subdirectories
   - Empty queue directories
   - Empty data directories
   - Empty archive directories


CURRENT DISK USAGE (Top 10)
────────────────────────────────────────────────────────────────────────────
1.5GB   models/                 # Qwen3-0.6B base model - KEEP
1.2GB   queue/                  # 3 stuck files (287MB each, 100k examples)
1.2GB   current_model_small/    # Old checkpoint from Nov 19
147MB   status/                 # Training status logs
5.6MB   data/                   # Validation sets + evolution snapshots
1.1MB   monitoring/             # Web UI and servers
1.1MB   logs/                   # Training logs
488KB   __pycache__/            # Python cache
276KB   core/                   # Main training code
220KB   tools/                  # Utilities


ISSUES IDENTIFIED
────────────────────────────────────────────────────────────────────────────

CRITICAL:
1. Queue has 3 large files causing OOM (861MB total)
   - queue/failed/syllo_autogen_20251122_034348_count100000.jsonl (287MB)
   - queue/failed/syllo_autogen_20251122_035104_count100000.jsonl (287MB)
   - queue/processing/syllo_autogen_20251122_035757_count100000.jsonl (287MB)

   OPTIONS:
   a) Delete them (training will generate new data)
   b) Split into smaller shards (50k examples each)
   c) Reduce batch_size to handle them

2. current_model_small/ (1.2GB) - Old checkpoint, not actively used
   OPTIONS:
   a) Delete (free up 1.2GB)
   b) Move to archive/old_checkpoints/
   c) Copy to 3090 as backup checkpoint

3. status/ logs (147MB) - Accumulating
   OPTIONS:
   a) Rotate old logs (keep last 7 days)
   b) Compress old logs
   c) Archive to backups/


LOW PRIORITY:
4. __pycache__/ (488KB) - Python bytecode cache
   ACTION: Can delete (regenerates automatically)

5. User notes directories (not in gitignore):
   - GOTCHA_BUSINESS_MODEL/ (40KB)
   - OBSERVATIONS/ (16KB)
   ACTION: Keep (user data)


CURRENT DIRECTORY STRUCTURE (CLEAN)
────────────────────────────────────────────────────────────────────────────
/path/to/training/
│
├── README.md                    # System overview
├── QUICKSTART.md                # Getting started
├── ARCHITECTURE.md              # System design
├── TROUBLESHOOTING.md           # Problem solving
├── DEVELOPMENT.md               # Development guide
├── CHANGELOG.md                 # Change tracking
├── REMOTE_INFERENCE.md          # 3090 API reference
├── 3090_SETUP.md                # 3090 setup guide
│
├── config.json                  # Active configuration
│
├── core/                        # Main training system (10 files)
│   ├── train.py                 # HuggingFace Trainer orchestrator
│   ├── training_daemon.py       # File watcher
│   ├── training_controller.py   # Control (pause/resume/stop)
│   ├── training_queue.py        # Queue management
│   ├── training_status.py       # Status JSON writer
│   ├── custom_collator.py       # Data collator
│   ├── logit_penalty.py         # Penalty processors
│   ├── validator.py             # Data validation
│   ├── model_db.py              # Model database
│   └── time_estimator.py        # Time estimation
│
├── monitoring/                  # Web UI + APIs
│   ├── servers/                 # Flask/FastAPI servers
│   │   ├── live_monitor.py      # Main monitor (:8080)
│   │   ├── memory_stats_api.py  # Memory stats (:8081)
│   │   └── enhanced_monitor.py  # Enhanced (:8082)
│   ├── ui/                      # HTML files
│   ├── js/                      # JavaScript modules
│   └── css/                     # Stylesheets
│
├── management/                  # Model/backup management
│   ├── backup_manager.py        # Backup system
│   ├── model_versioner.py       # Version control
│   ├── consolidate_model.py     # Model consolidation
│   ├── checkpoint_retention.py  # Checkpoint cleanup
│   └── auto_disk_manager.py     # Auto disk cleanup
│
├── safety/                      # Watchdogs + health checks
│   ├── daemon_watchdog.py       # Auto-restart daemon
│   ├── anti_stuck_monitor.py    # Detect hangs
│   ├── crash_detector.py        # Crash analysis
│   ├── comprehensive_health_check.py
│   └── config_validator.py      # Config validation
│
├── tools/                       # Utilities
│   ├── data/                    # Data processing
│   ├── config/                  # Config editing
│   └── analysis/                # Analysis tools
│
├── tests/                       # Test files
│
├── scripts/                     # Shell scripts
│   ├── start_all.sh             # Start all services
│   ├── check_health.sh          # Health check
│   └── bin/                     # Launcher scripts
│
├── models/                      # Model storage
│   └── Qwen3-0.6B/              # Base model (1.5GB)
│
├── data/                        # Training data
│   ├── validation/              # Fixed validation set
│   └── evolution_snapshots/     # Snapshots (minimal now)
│
├── inbox/                       # Drop zone for training files
│
├── queue/                       # Priority queues
│   ├── failed/                  # Failed files (2 x 287MB)
│   ├── processing/              # Currently training (1 x 287MB)
│   └── recently_completed/      # Just finished (1 x 340MB)
│
├── logs/                        # Training logs
├── status/                      # Status JSON files (147MB)
├── control/                     # Control files (.stop, .pause, etc.)
│
├── current_model_small/         # Old checkpoint (1.2GB)
│
├── scratch/                     # Working files
│
├── archive/                     # Archived/experimental
│   ├── configs/                 # Old configs
│   └── experiments/             # Experimental scripts
│
├── GOTCHA_BUSINESS_MODEL/       # User notes (ignored by cleanup)
└── OBSERVATIONS/                # User notes (ignored by cleanup)


PROPOSED CLEANUP ACTIONS
────────────────────────────────────────────────────────────────────────────

IMMEDIATE (Before Redesign):
1. Clear stuck queue files
   rm queue/failed/*.jsonl
   rm queue/processing/*.jsonl
   # Saves: 861MB

2. Archive or delete current_model_small
   mv current_model_small archive/old_checkpoints/qwen3_small_nov19/
   # Saves: 1.2GB

3. Delete Python cache
   rm -rf __pycache__/
   # Saves: 488KB

4. Rotate old status logs
   find status/logs/ -name "*.json" -mtime +7 -delete
   # Saves: ~50-100MB (estimate)

TOTAL SPACE FREED: ~2.1GB


OPTIONAL (If Needed):
5. Compress old logs
   gzip logs/*.log
   # Saves: ~50%

6. Clean evolution snapshots (already minimal)
   # Currently only 5.6MB total - leave as-is


PREPARE FOR REGIME-3 REDESIGN:
────────────────────────────────────────────────────────────────────────────

CREATE NEW DIRECTORIES:
mkdir -p regime3/
mkdir -p regime3/encoders/          # Canonical → encoded
mkdir -p regime3/decoders/          # Encoded → canonical
mkdir -p regime3/canonical_data/    # Canonical representations
mkdir -p regime3/encoded_data/      # Encoded training data
mkdir -p regime3/eval_sets/         # Regime-3 eval sets
mkdir -p regime3/tokenizers/        # Custom tokenizers (if needed)

PRESERVE CURRENT SYSTEM:
# Don't delete anything in core/ until new system is ready
# Keep config.json as reference
# Keep queue/ structure (just clean files)
# Keep monitoring/ structure (web UI still works)


RECOMMENDED NEXT STEPS
────────────────────────────────────────────────────────────────────────────

1. Run cleanup commands (see below)
2. Initialize new regime-3 directory structure
3. Create regime-3 design doc (canonical format, encoding strategy)
4. Implement encoder/decoder modules
5. Create sample regime-3 data
6. Test encoding/decoding
7. Integrate with trainer
8. Migrate web UI to support regime-3 metrics


CLEANUP COMMANDS (SAFE TO RUN)
────────────────────────────────────────────────────────────────────────────

# 1. Clear stuck queue files
rm -f queue/failed/*.jsonl
rm -f queue/processing/*.jsonl
rm -f queue/recently_completed/*.jsonl

# 2. Archive old checkpoint
mkdir -p archive/old_checkpoints
mv current_model_small archive/old_checkpoints/qwen3_small_nov19

# 3. Delete Python cache
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null

# 4. Rotate old status logs (keep last 7 days)
find status/logs/ -name "*.json" -mtime +7 -delete 2>/dev/null

# 5. Create regime-3 structure
mkdir -p regime3/{encoders,decoders,canonical_data,encoded_data,eval_sets,tokenizers}

# 6. Verify cleanup
du -sh * | sort -hr | head -10


FINAL STRUCTURE AFTER CLEANUP
────────────────────────────────────────────────────────────────────────────

Expected disk usage:
1.5GB   models/         (Qwen3-0.6B - unchanged)
276KB   core/           (unchanged)
220KB   tools/          (unchanged)
~50MB   status/         (after rotation)
~1MB    monitoring/     (unchanged)
~1MB    logs/           (unchanged)

TOTAL: ~1.55GB (down from ~4GB)


════════════════════════════════════════════════════════════════════════════
END OF CLEANUP REPORT
════════════════════════════════════════════════════════════════════════════
