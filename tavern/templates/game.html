<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realm of Training</title>
    <!-- Shared theme (design tokens, badges, components) -->
    <link rel="stylesheet" href="/static/css/theme.css?v=1">
    <!-- Main game styles -->
    <link rel="stylesheet" href="/static/css/game.css?v=7">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- üî• RPG FLAIR: Global Overlays -->
    <div class="critical-hit-overlay" id="critOverlay">
        <span class="critical-hit-text">CRITICAL!</span>
    </div>
    <div class="achievement-toast" id="achievementToast">
        <span class="achievement-icon" id="achievementIcon">üèÜ</span>
        <div class="achievement-text">
            <div class="achievement-title">Achievement Unlocked</div>
            <div class="achievement-name" id="achievementName">First Steps</div>
        </div>
    </div>
    <div class="zone-discovery" id="zoneDiscovery">
        <div class="zone-discovery-title" id="zoneName">Level 20</div>
        <div class="zone-discovery-subtitle">Zone Discovered</div>
    </div>
    <div class="weather-overlay" id="weatherOverlay"></div>

    <!-- TITLE BAR -->
    <header class="game-header">
        <div class="header-left">
            <h1 class="game-title">Realm of Training</h1>
        </div>
        <div class="header-center">
            <div class="resource-bar">
                <div class="resource steps">
                    <span class="resource-icon">‚ö°</span>
                    <span class="resource-label">STEPS</span>
                    <span class="resource-value" id="totalSteps">0</span>
                </div>
                <div class="resource evals">
                    <span class="resource-icon">üéØ</span>
                    <span class="resource-label">EVALS</span>
                    <span class="resource-value" id="totalEvals">0</span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <!-- REALM MODE TOGGLE -->
            <div class="realm-mode-toggle" id="realmModeToggle">
                <button class="mode-btn mode-training" id="btnTraining" title="Enable auto-training">TRAIN</button>
                <button class="mode-btn mode-idle" id="btnIdle" title="Pause auto-training">IDLE</button>
            </div>
            <!-- HEALTH INDICATOR -->
            <div class="health-indicator" id="healthIndicator" title="Realm health">
                <span class="health-icon" id="healthIcon">‚ö™</span>
            </div>
            <!-- IDLE INDICATOR (now shows actual realm mode) -->
            <div class="idle-indicator" id="idleIndicator">
                <span class="idle-icon" id="modeIcon">üí§</span>
                <span class="idle-text" id="modeText">IDLE</span>
            </div>
            <div class="time-display" id="timeDisplay">--:--:--</div>
        </div>
    </header>

    <!-- üéÆ MUD CONSOLE (toggle with ` backtick) -->
    <div class="realm-console collapsed" id="realmConsole">
        <div class="console-header">
            <span class="console-title">‚å®Ô∏è Realm Console</span>
            <span class="console-hint">Press <kbd>`</kbd> to toggle ‚Ä¢ <kbd>‚Üë‚Üì</kbd> history</span>
            <button class="console-close" onclick="RealmConsole.toggle()">√ó</button>
        </div>
        <div class="console-output" id="consoleOutput">
            <div class="console-line console-system">You stand at the entrance to the Realm. Type <span class="cmd">help</span> to begin...</div>
        </div>
        <div class="console-input-row">
            <span class="console-prompt" id="consolePrompt">&gt;</span>
            <input type="text" id="consoleInput" autocomplete="off" spellcheck="false" placeholder="Enter command..." />
        </div>
    </div>

    <!-- MAIN GAME AREA -->
    <main class="game-main">
        <!-- LEFT: HERO PANEL -->
        <section class="hero-panel">
            <div class="hero-frame">
                <div class="hero-portrait" id="heroPortrait">
                    <!-- Hero with idle animation -->
                    <div class="hero-ascii">
                        <div class="dio-icon" id="heroSprite">üßîüèΩ</div>
                    </div>
                    <!-- ‚ú® Sparkle overlay -->
                    <span class="hero-sparkle">‚ú®</span>
                </div>
                <div class="hero-glow"></div>

                <!-- üó∫Ô∏è Mini-Map -->
                <div class="realm-minimap" id="realmMinimap" title="The Realm">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- üíöüíôüíõ HP/MP/Stamina Resource Bars (WoW Style) -->
            <div class="hero-resources">
                <div class="resource-bar-wow hp" title="VRAM - Hero's health">
                    <span class="bar-label">VRAM</span>
                    <div class="bar-fill" id="hpBarFill" style="width: 50%"></div>
                    <span class="bar-text" id="hpBarText">12 / 24 GB</span>
                </div>
                <div class="resource-bar-wow mp" title="RAM - Hero's mana">
                    <span class="bar-label">RAM</span>
                    <div class="bar-fill" id="mpBarFill" style="width: 50%"></div>
                    <span class="bar-text" id="mpBarText">32 / 64 GB</span>
                </div>
                <div class="resource-bar-wow stamina" title="GPU Utilization - Hero's stamina">
                    <span class="bar-label">STAM</span>
                    <div class="bar-fill" id="staminaBarFill" style="width: 0%"></div>
                    <span class="bar-text" id="staminaBarText">0%</span>
                </div>
            </div>

            <div class="hero-info">
                <h2 class="hero-name" id="heroName">...</h2>
                <p class="hero-title" id="heroTitle">Loading...</p>
                <div class="hero-class" id="heroClass">-</div>
            </div>

            <div class="hero-level-bar">
                <div class="level-badge" title="Total level = sum of all MASTERED skill levels">TOTAL <span id="totalLevel">0</span></div>
                <div class="current-skill" id="currentSkillBadge">
                    <span class="skill-training">Training:</span>
                    <span class="skill-name" id="currentSkillName">BIN</span>
                    <span class="skill-lvl">L<span id="currentSkillLevel">1</span></span>
                </div>
            </div>

            <div class="hero-stats">
                <div class="stat-row">
                    <div class="stat" title="Curriculum evaluation accuracy. Higher = better skill mastery.">
                        <span class="stat-icon">üéØ</span>
                        <span class="stat-label">ACCURACY</span>
                        <span class="stat-value" id="statAcc">0%</span>
                    </div>
                </div>
                <div class="stat-row">
                    <div class="stat" title="Clarity = 1/Perplexity. Higher = less confused, sharper understanding.">
                        <span class="stat-icon">üíé</span>
                        <span class="stat-label">CLARITY</span>
                        <span class="stat-value" id="statClarity">--</span>
                    </div>
                </div>
                <div class="stat-row">
                    <div class="stat" title="Strain = Training Loss. Lower = easier learning, less struggle.">
                        <span class="stat-icon">üí™</span>
                        <span class="stat-label">STRAIN</span>
                        <span class="stat-value" id="statStrain">--</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- CENTER: BATTLE/QUEST AREA -->
        <section class="battle-panel">
            <!-- üìú MUD ROOM DESCRIPTION -->
            <div class="room-description" id="roomDescription">
                You stand in the Training Grounds. The air crackles with gradients.
                Distant echoes of loss curves rumble like thunder across the Realm.
                <div class="room-exits">
                    Obvious exits: <a href="/guild">Guild Hall</a>, <a href="/vault">Vault</a>, <a href="/oracle">Oracle</a>, <a href="/quests">Quest Board</a>, <a href="/temple">Temple</a>
                </div>
            </div>

            <!-- NEXT ACTION - The main call-to-action -->
            <div class="next-action-card" id="nextActionSection">
                <h2 class="next-action-title" id="nextActionTitle">Loading...</h2>
                <p class="next-action-body" id="nextActionBody"></p>
                <button class="next-action-btn btn-spellcast" id="nextActionButton">...</button>
            </div>

            <!-- POLICY 3: STALENESS WARNING BANNER -->
            <div id="dataFreshnessWarning" class="warning-banner" style="display:none;">
                ‚ö†Ô∏è <span id="freshnessMessage"></span>
            </div>

            <!-- BATTLE STATUS -->
            <div class="battle-status" id="battleStatus">
                <div class="battle-header">
                    <span class="battle-icon" id="battleIcon">üí§</span>
                    <h3 class="battle-title" id="battleTitle">Awaiting Orders</h3>
                </div>

                <!-- Action Hint - contextual advice -->
                <div class="action-hint" id="actionHint" style="font-size: 0.75rem; color: #a0a0b0; padding: 0.25rem 0.5rem; margin-bottom: 0.5rem; font-style: italic; min-height: 1.2rem;"></div>

                <div class="quest-info" id="questInfo">
                    <div class="quest-name" id="questName">No active quest</div>
                    <div class="quest-progress-container">
                        <div class="quest-progress-bar" id="questProgressBar"></div>
                        <span class="quest-progress-text" id="questProgressText">0%</span>
                    </div>
                </div>

                <div class="battle-stats" id="battleStats">
                    <div class="battle-stat" title="Current training step">
                        <span class="bs-label">Step</span>
                        <span class="bs-value" id="battleStep">--</span>
                    </div>
                    <div class="battle-stat" title="Training speed (steps per second)">
                        <span class="bs-label">Speed</span>
                        <span class="bs-value" id="battleSpeed">--</span>
                    </div>
                    <div class="battle-stat" title="Current training strain (loss). Lower = learning more easily.">
                        <span class="bs-label">Strain</span>
                        <span class="bs-value" id="battleStrain">--</span>
                    </div>
                    <div class="battle-stat" title="Estimated time remaining">
                        <span class="bs-label">ETA</span>
                        <span class="bs-value" id="battleETA">--</span>
                    </div>
                </div>

                <!-- LOSS GRAPH -->
                <div class="loss-graph-container">
                    <div class="loss-graph-header">
                        <span class="loss-graph-title">Effort History (Cumulative Strain)</span>
                        <span class="loss-graph-range" id="lossGraphRange">Last 200 steps</span>
                    </div>
                    <canvas id="lossChart" width="280" height="80"></canvas>
                    <div class="loss-graph-footer">
                        <span class="loss-min" id="lossMin">--</span>
                        <span class="loss-trend" id="lossTrend">--</span>
                        <span class="loss-max" id="lossMax">--</span>
                    </div>
                </div>

                <!-- TRAINING CONTROLS -->
                <div class="training-controls" id="trainingControls">
                    <button class="control-btn pause" id="btnPause" onclick="controlTraining('pause')" title="Pause training after current step">
                        <span class="btn-icon">‚è∏</span> Pause
                    </button>
                    <button class="control-btn resume" id="btnResume" onclick="controlTraining('resume')" title="Resume training" style="display: none;">
                        <span class="btn-icon">‚ñ∂</span> Resume
                    </button>
                    <button class="control-btn stop" id="btnStop" onclick="controlTraining('stop')" title="Stop training completely">
                        <span class="btn-icon">‚èπ</span> Stop
                    </button>
                </div>

                <!-- MOMENTUM ENGINE - Forward Progress / Blockers -->
                <div class="momentum-card" id="momentumCard" style="display: none;">
                    <div class="momentum-header">
                        <span class="momentum-badge" id="momentumBadge">
                            <span class="momentum-icon">‚ö°</span>
                            <span class="momentum-status" id="momentumStatus">GO</span>
                        </span>
                        <span class="momentum-title">Forward Momentum</span>
                    </div>
                    <div class="momentum-blocker" id="momentumBlocker" style="display: none;">
                        <div class="blocker-what" id="blockerWhat"></div>
                        <div class="blocker-why" id="blockerWhy"></div>
                        <div class="blocker-how" id="blockerHow"></div>
                        <button class="blocker-action-btn" id="blockerActionBtn">Fix This</button>
                    </div>
                </div>
            </div>

            <!-- RECENT ACTIVITY -->
            <div class="activity-log">
                <h4>Battle Log</h4>
                <div class="log-entries" id="logEntries">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- RIGHT: SKILLS & GUILD -->
        <section class="guild-panel">
            <div class="panel-header">
                <h3>üè∞ Guild Skills</h3>
            </div>

            <!-- SKILLS (Loaded dynamically from YAML configs) -->
            <div id="skillsContainer">
                <!-- Skills will be rendered here by JavaScript -->
                <div class="skill-card loading">
                    <div class="skill-header">
                        <span class="skill-icon">‚è≥</span>
                        <span class="skill-name">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- VAULT SUMMARY -->
            <div class="vault-card">
                <div class="panel-header">
                    <h3>üóùÔ∏è Vault</h3>
                </div>
                <div class="vault-stats">
                    <div class="vault-stat">
                        <span class="vs-label">Checkpoints</span>
                        <span class="vs-value" id="vaultCheckpoints">--</span>
                    </div>
                    <div class="vault-stat">
                        <span class="vs-label">Total Size</span>
                        <span class="vs-value" id="vaultSize">-- GB</span>
                    </div>
                    <div class="vault-stat">
                        <span class="vs-label">Best Model</span>
                        <span class="vs-value" id="vaultBest">--</span>
                    </div>
                </div>
            </div>

            <!-- FORGE STATUS -->
            <div class="forge-card">
                <div class="panel-header forge-header">
                    <span class="forge-torch forge-torch-left">üî•</span>
                    <h3>‚öíÔ∏è The Forge (4090)</h3>
                    <span class="forge-torch forge-torch-right">üî•</span>
                </div>
                <div class="forge-stats">
                    <div class="forge-meter">
                        <span class="meter-label">VRAM</span>
                        <div class="meter-bar-container">
                            <div class="meter-bar" id="forgeVramBar"></div>
                        </div>
                        <span class="meter-value" id="forgeVram">-- GB</span>
                    </div>
                    <div class="forge-meter">
                        <span class="meter-label">Temp</span>
                        <div class="meter-bar-container temp">
                            <div class="meter-bar" id="forgeTempBar"></div>
                        </div>
                        <span class="meter-value" id="forgeTemp">--¬∞C</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- NAVIGATION (dynamic) -->
    <nav class="game-nav" id="bottomNav"></nav>
    <script src="/static/js/nav.js"></script>
    <script src="/static/js/events.js"></script>

    <!-- FLOATING NOTIFICATIONS -->
    <div class="notifications" id="notifications">
        <!-- Notifications will be injected here -->
    </div>

    <!-- Shared modules (load before game.js) -->
    <script src="/static/js/formatters.js?v=1"></script>
    <script src="/static/js/training_client.js?v=1"></script>
    <script src="/static/js/polling.js?v=1"></script>
    <script src="/static/js/training_controls.js?v=1"></script>
    <!-- Unified Realm State (single source of truth) -->
    <script src="/static/js/realm-state.js?v=1"></script>
    <!-- Main game logic -->
    <script src="/static/js/game.js?v=21"></script>
</body>
</html>
