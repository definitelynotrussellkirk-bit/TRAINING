<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garrison | Realm of Training</title>
    <link rel="stylesheet" href="/static/css/theme.css?v=1">
    <link rel="stylesheet" href="/static/css/game.css?v=8">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        .garrison-page {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        body {
            padding-bottom: 80px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HERO BANNER - Fleet Commander
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .fleet-banner {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border: 2px solid #333;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 24px;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .fleet-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at 30% 50%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .fleet-icon-container {
            position: relative;
        }

        .fleet-icon {
            font-size: 4rem;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.3));
        }

        .fleet-status-ring {
            position: absolute;
            top: -8px;
            left: -8px;
            width: calc(100% + 16px);
            height: calc(100% + 16px);
            border-radius: 50%;
            border: 3px solid transparent;
            animation: pulse-ring 2s ease-in-out infinite;
        }

        .fleet-status-ring.healthy {
            border-color: #4CAF50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
        }

        .fleet-status-ring.warning {
            border-color: #ffa726;
            box-shadow: 0 0 15px rgba(255, 167, 38, 0.4);
            animation: pulse-ring-warning 1.5s ease-in-out infinite;
        }

        .fleet-status-ring.critical {
            border-color: #f44336;
            box-shadow: 0 0 15px rgba(244, 67, 54, 0.4);
            animation: pulse-ring-critical 1s ease-in-out infinite;
        }

        @keyframes pulse-ring {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.02); }
        }

        @keyframes pulse-ring-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes pulse-ring-critical {
            0%, 100% { opacity: 1; box-shadow: 0 0 15px rgba(244, 67, 54, 0.4); }
            50% { opacity: 0.8; box-shadow: 0 0 25px rgba(244, 67, 54, 0.6); }
        }

        .fleet-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .fleet-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: #ffd700;
            margin: 0;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .fleet-subtitle {
            color: #888;
            font-size: 0.9rem;
        }

        .fleet-stats {
            display: flex;
            gap: 24px;
            margin-top: 8px;
        }

        .fleet-stat {
            display: flex;
            flex-direction: column;
        }

        .fleet-stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #fff;
        }

        .fleet-stat-value.healthy { color: #4CAF50; }
        .fleet-stat-value.warning { color: #ffa726; }
        .fleet-stat-value.critical { color: #f44336; }

        .fleet-stat-label {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
        }

        .fleet-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .fleet-action {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .fleet-action:hover {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.4);
            transform: translateX(4px);
        }

        .fleet-action.scanning {
            animation: scanning 1s ease-in-out infinite;
        }

        @keyframes scanning {
            0%, 100% { background: rgba(33, 150, 243, 0.2); }
            50% { background: rgba(33, 150, 243, 0.4); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STRATEGIC OVERVIEW - Locations Grid
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .strategic-overview {
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .section-title {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-badge {
            background: rgba(255, 215, 0, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            color: #ffd700;
            font-family: 'Inter', sans-serif;
        }

        .locations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .location-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .location-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            transition: all 0.3s;
        }

        .location-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .location-card.online {
            border-color: rgba(76, 175, 80, 0.4);
        }

        .location-card.online::before {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .location-card.warning {
            border-color: rgba(255, 167, 38, 0.4);
        }

        .location-card.warning::before {
            background: #ffa726;
            box-shadow: 0 0 10px rgba(255, 167, 38, 0.5);
        }

        .location-card.offline {
            opacity: 0.6;
        }

        .location-card.offline::before {
            background: #666;
        }

        .location-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .location-info {
            flex: 1;
            min-width: 0;
        }

        .location-name {
            font-weight: 600;
            color: #fff;
            font-size: 0.95rem;
            margin-bottom: 2px;
        }

        .location-status {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .location-status.online { color: #4CAF50; }
        .location-status.warning { color: #ffa726; }
        .location-status.offline { color: #666; }
        .location-status.healthy { color: #4CAF50; }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: blink 2s ease-in-out infinite;
        }

        .location-card.warning .status-dot {
            animation: blink-fast 1s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes blink-fast {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .location-stats {
            font-size: 0.75rem;
            color: #888;
            margin-top: 4px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ALERTS SECTION
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .alerts-section {
            background: linear-gradient(135deg, #2a1a1a 0%, #1a0d0d 100%);
            border: 1px solid #5a2a2a;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            animation: alert-pulse 3s ease-in-out infinite;
        }

        @keyframes alert-pulse {
            0%, 100% { border-color: #5a2a2a; }
            50% { border-color: #8a3a3a; }
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .alerts-title {
            color: #f44336;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-count {
            background: #f44336;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        .alert-item {
            padding: 10px 14px;
            background: rgba(244, 67, 54, 0.1);
            border-left: 3px solid #f44336;
            border-radius: 0 6px 6px 0;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #ffcdd2;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-item:last-child {
            margin-bottom: 0;
        }

        .alert-icon {
            font-size: 1.1rem;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ZONES DISPLAY - Thermometer Style
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .zones-section {
            margin-bottom: 24px;
        }

        .zones-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .zone-card {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
        }

        .zone-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
        }

        .zone-card.hot::before { background: linear-gradient(90deg, #f44336, #ff7043); }
        .zone-card.warm::before { background: linear-gradient(90deg, #ffa726, #ffcc02); }
        .zone-card.cold::before { background: linear-gradient(90deg, #2196F3, #00bcd4); }

        .zone-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .zone-icon {
            font-size: 1.5rem;
        }

        .zone-name {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            color: #888;
            letter-spacing: 0.5px;
        }

        .zone-percent {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .zone-card.hot .zone-percent { color: #ff7043; }
        .zone-card.warm .zone-percent { color: #ffcc02; }
        .zone-card.cold .zone-percent { color: #4fc3f7; }

        .zone-detail {
            font-size: 0.85rem;
            color: #888;
        }

        .zone-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 12px;
            overflow: hidden;
        }

        .zone-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .zone-card.hot .zone-bar-fill { background: linear-gradient(90deg, #f44336, #ff7043); }
        .zone-card.warm .zone-bar-fill { background: linear-gradient(90deg, #ffa726, #ffcc02); }
        .zone-card.cold .zone-bar-fill { background: linear-gradient(90deg, #2196F3, #00bcd4); }

        .zone-devices {
            margin-top: 8px;
            font-size: 0.75rem;
            color: #666;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HOST CARDS - Enhanced
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .hosts-section {
            margin-bottom: 24px;
        }

        .hosts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 20px;
        }

        .host-card {
            background: linear-gradient(180deg, #252538 0%, #1a1a2e 100%);
            border-radius: 16px;
            border: 1px solid #333;
            overflow: hidden;
            transition: all 0.3s;
        }

        .host-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
            border-color: #444;
        }

        /* Role-based top accent */
        .host-card.role-trainer {
            border-top: 4px solid #ffd700;
        }
        .host-card.role-inference {
            border-top: 4px solid #9c27b0;
        }
        .host-card.role-storage {
            border-top: 4px solid #2196F3;
        }
        .host-card.role-worker {
            border-top: 4px solid #4CAF50;
        }

        .host-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .host-identity {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .host-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .host-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 2px;
        }

        .host-ip {
            color: #666;
            font-size: 0.85rem;
            font-family: monospace;
        }

        .host-roles {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 6px;
        }

        .role-badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 4px;
            background: #333;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-badge.trainer { background: rgba(255, 215, 0, 0.2); color: #ffd700; }
        .role-badge.inference { background: rgba(156, 39, 176, 0.2); color: #ce93d8; }
        .role-badge.eval_worker { background: rgba(76, 175, 80, 0.2); color: #a5d6a7; }
        .role-badge.data_forge { background: rgba(255, 152, 0, 0.2); color: #ffcc80; }
        .role-badge.storage_warm { background: rgba(255, 167, 38, 0.2); color: #ffcc80; }
        .role-badge.storage_cold { background: rgba(33, 150, 243, 0.2); color: #90caf9; }
        .role-badge.control_plane { background: rgba(255, 215, 0, 0.2); color: #ffd700; }

        .host-status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .host-status-badge.healthy {
            background: linear-gradient(135deg, #1b5e20, #2e7d32);
            color: #a5d6a7;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }
        .host-status-badge.warning {
            background: linear-gradient(135deg, #e65100, #f57c00);
            color: #ffcc80;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.3);
            animation: pulse-badge 2s ease-in-out infinite;
        }
        .host-status-badge.critical {
            background: linear-gradient(135deg, #b71c1c, #c62828);
            color: #ef9a9a;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.3);
            animation: pulse-badge 1s ease-in-out infinite;
        }
        .host-status-badge.unknown, .host-status-badge.offline {
            background: #37474f;
            color: #90a4ae;
        }

        @keyframes pulse-badge {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .host-body {
            padding: 20px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .metric-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 14px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .metric-card.wide {
            grid-column: span 2;
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .metric-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-icon {
            font-size: 1rem;
            opacity: 0.6;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }

        .metric-value.good { color: #4CAF50; }
        .metric-value.warning { color: #ffa726; }
        .metric-value.critical { color: #f44336; }

        .metric-detail {
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
        }

        .metric-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .metric-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .metric-bar-fill.good { background: linear-gradient(90deg, #4CAF50, #66BB6A); }
        .metric-bar-fill.warning { background: linear-gradient(90deg, #ffa726, #ffcc02); }
        .metric-bar-fill.critical { background: linear-gradient(90deg, #f44336, #ff7043); }

        /* Services Section */
        .services-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .services-title {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        .services-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .service-badge {
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .service-badge.up {
            background: rgba(76, 175, 80, 0.15);
            color: #a5d6a7;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        .service-badge.down {
            background: rgba(244, 67, 54, 0.15);
            color: #ef9a9a;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        .service-badge.error {
            background: rgba(255, 152, 0, 0.15);
            color: #ffcc80;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .service-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .service-badge.up .service-dot { background: #4CAF50; }
        .service-badge.down .service-dot { background: #f44336; }
        .service-badge.error .service-dot { background: #ffa726; }

        /* Volumes Section */
        .volumes-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .volumes-title {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        .volume-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .volume-path {
            color: #aaa;
            font-size: 0.85rem;
            font-family: monospace;
        }

        .volume-stats {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .volume-stats.good { color: #4CAF50; }
        .volume-stats.warning { color: #ffa726; }
        .volume-stats.critical { color: #f44336; }

        /* Issues Section */
        .issues-section {
            margin-top: 12px;
        }

        .issue-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: rgba(255, 152, 0, 0.1);
            border-left: 3px solid #ffa726;
            border-radius: 0 8px 8px 0;
            font-size: 0.85rem;
            color: #ffcc80;
            margin-bottom: 8px;
        }

        .issue-item:last-child {
            margin-bottom: 0;
        }

        /* RAID Status */
        .raid-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 12px;
        }

        .raid-badge.healthy {
            background: rgba(76, 175, 80, 0.15);
            color: #a5d6a7;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        .raid-badge.degraded {
            background: rgba(244, 67, 54, 0.15);
            color: #ef9a9a;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        /* Uptime */
        .uptime {
            font-size: 0.8rem;
            color: #666;
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FOOTER & UTILITIES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 24px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .cache-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 8px;
        }

        .cache-badge.live {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .cache-badge.cached {
            background: rgba(255, 167, 38, 0.2);
            color: #ffa726;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 40px;
            color: #888;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #333;
            border-top-color: #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1rem;
            color: #888;
        }

        /* Header Overrides */
        .header-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            color: #fff;
        }

        .btn-sm:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.4);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .fleet-banner {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .fleet-stats {
                justify-content: center;
            }

            .fleet-actions {
                flex-direction: row;
                justify-content: center;
            }

            .hosts-grid {
                grid-template-columns: 1fr;
            }

            .zones-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- TITLE BAR -->
    <header class="game-header">
        <div class="header-left">
            <h1 class="game-title">ğŸ›¡ï¸ Garrison</h1>
        </div>
        <div class="header-center">
            <div class="resource-bar">
                <div class="resource">
                    <span class="resource-icon">ğŸ–¥ï¸</span>
                    <span class="resource-label">HOSTS</span>
                    <span class="resource-value" id="hostCount">0</span>
                </div>
                <div class="resource">
                    <span class="resource-icon" id="statusIcon">âšª</span>
                    <span class="resource-label">STATUS</span>
                    <span class="resource-value" id="statusText">--</span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <button class="btn btn-sm" onclick="refreshStatus()" title="Quick refresh (cached)">ğŸ”„</button>
            <button class="btn btn-sm" id="scanBtn" onclick="refreshStatus(true)" title="Full fleet scan">ğŸ“¡ Scan</button>
        </div>
    </header>

    <div class="garrison-page">
        <!-- Fleet Commander Banner -->
        <div class="fleet-banner" id="fleetBanner">
            <div class="fleet-icon-container">
                <div class="fleet-status-ring" id="statusRing"></div>
                <div class="fleet-icon">ğŸ°</div>
            </div>
            <div class="fleet-info">
                <h2 class="fleet-title">Fleet Command</h2>
                <div class="fleet-subtitle" id="fleetSubtitle">Monitoring distributed training infrastructure</div>
                <div class="fleet-stats" id="fleetStats">
                    <div class="fleet-stat">
                        <span class="fleet-stat-value" id="onlineCount">-</span>
                        <span class="fleet-stat-label">Online</span>
                    </div>
                    <div class="fleet-stat">
                        <span class="fleet-stat-value" id="alertCount">-</span>
                        <span class="fleet-stat-label">Alerts</span>
                    </div>
                    <div class="fleet-stat">
                        <span class="fleet-stat-value" id="serviceCount">-</span>
                        <span class="fleet-stat-label">Services</span>
                    </div>
                </div>
            </div>
            <div class="fleet-actions">
                <button class="fleet-action" onclick="refreshStatus(true)" id="scanAction">
                    <span>ğŸ“¡</span> Scan Fleet
                </button>
                <button class="fleet-action" onclick="runMaintenance()">
                    <span>ğŸ”§</span> Maintenance
                </button>
            </div>
        </div>

        <!-- Strategic Overview (Locations) -->
        <div class="strategic-overview">
            <div class="section-header">
                <div class="section-title">
                    <span>ğŸ“</span> Strategic Overview
                    <span class="section-badge" id="locationsBadge">0 locations</span>
                </div>
            </div>
            <div class="locations-grid" id="locationsGrid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Alerts Section -->
        <div id="alerts-container"></div>

        <!-- Zones Section -->
        <div class="zones-section" id="zones-section" style="display: none;">
            <div class="section-header">
                <div class="section-title">
                    <span>ğŸŒ¡ï¸</span> Storage Zones
                </div>
            </div>
            <div class="zones-grid" id="zones-grid"></div>
        </div>

        <!-- Hosts Section -->
        <div class="hosts-section">
            <div class="section-header">
                <div class="section-title">
                    <span>ğŸ–¥ï¸</span> Host Status
                    <span class="section-badge" id="hostsBadge">0 hosts</span>
                </div>
            </div>
            <div class="hosts-grid" id="hosts-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <p class="loading-text">Connecting to fleet...</p>
                </div>
            </div>
        </div>

        <div id="last-updated" class="last-updated"></div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="game-nav" id="bottomNav"></nav>
    <script src="/static/js/nav.js"></script>

    <script>
        let statusData = null;

        // Helper functions
        function getProgressClass(percent) {
            if (percent >= 90) return 'critical';
            if (percent >= 80) return 'warning';
            return 'good';
        }

        function formatBytes(mb) {
            if (mb >= 1024) return (mb / 1024).toFixed(1) + ' GB';
            return mb.toFixed(0) + ' MB';
        }

        function getRoleClass(host) {
            const roles = host.roles || [];
            if (roles.includes('trainer') || roles.includes('control_plane')) return 'role-trainer';
            if (roles.includes('inference')) return 'role-inference';
            if (roles.includes('storage_warm') || roles.includes('storage_cold')) return 'role-storage';
            if (roles.includes('eval_worker') || roles.includes('data_forge')) return 'role-worker';
            return '';
        }

        function getHostIcon(host) {
            const roles = host.roles || [];
            if (roles.includes('trainer') || roles.includes('control_plane')) return 'ğŸ’»';
            if (roles.includes('inference')) return 'ğŸ”®';
            if (roles.includes('storage_warm') || roles.includes('storage_cold')) return 'ğŸ“¦';
            return 'ğŸ–¥ï¸';
        }

        // Render fleet banner
        function renderFleetBanner(data) {
            const status = data.overall_status || 'unknown';
            const hosts = Object.values(data.hosts || {});
            const onlineCount = hosts.filter(h => h.status === 'healthy' || h.status === 'online').length;
            const alertCount = (data.alerts || []).length;

            // Count services
            let serviceCount = 0;
            hosts.forEach(h => {
                const services = Object.keys(h.services || {}).filter(k => k !== 'name' && k !== 'checkpoints');
                serviceCount += services.filter(s => h.services[s] === 'up').length;
            });

            // Update stats
            document.getElementById('onlineCount').textContent = onlineCount;
            document.getElementById('onlineCount').className = 'fleet-stat-value ' + (onlineCount > 0 ? 'healthy' : 'critical');

            document.getElementById('alertCount').textContent = alertCount;
            document.getElementById('alertCount').className = 'fleet-stat-value ' + (alertCount === 0 ? 'healthy' : alertCount <= 2 ? 'warning' : 'critical');

            document.getElementById('serviceCount').textContent = serviceCount;
            document.getElementById('serviceCount').className = 'fleet-stat-value healthy';

            // Update status ring
            const ring = document.getElementById('statusRing');
            ring.className = 'fleet-status-ring ' + status;

            // Update subtitle
            const subtitle = document.getElementById('fleetSubtitle');
            const statusText = {
                'healthy': 'All systems operational',
                'warning': 'Some systems require attention',
                'critical': 'Critical issues detected',
                'unknown': 'Fleet status unknown',
                'offline': 'Fleet offline'
            };
            subtitle.textContent = statusText[status] || 'Monitoring distributed infrastructure';
        }

        // Render locations
        function renderLocations(hosts) {
            const container = document.getElementById('locationsGrid');
            if (!container) return;

            const locationDefs = [
                { id: 'trainer4090', icon: 'ğŸ’»', name: 'Trainer (4090)', hostKey: 'trainer4090' },
                { id: 'inference3090', icon: 'ğŸ”®', name: 'Inference (3090)', hostKey: 'inference3090' },
                { id: 'synology_data', icon: 'ğŸ“¦', name: 'Synology NAS', hostKey: 'synology_data' },
                { id: 'vault', icon: 'ğŸ—ï¸', name: 'Vault', service: true, port: 8767 },
                { id: 'oracle', icon: 'ğŸ”®', name: 'Oracle', service: true, port: 8765 },
                { id: 'tavern', icon: 'ğŸ°', name: 'Tavern', service: true, port: 8888 },
            ];

            let onlineCount = 0;
            let html = '';

            for (const loc of locationDefs) {
                let status = 'offline';
                let statusText = 'Offline';
                let statsText = '';

                if (loc.hostKey && hosts) {
                    const host = hosts[loc.hostKey];
                    if (host) {
                        status = host.status === 'healthy' ? 'online' : host.status || 'unknown';
                        if (status === 'online' || status === 'healthy') onlineCount++;
                        statusText = status.charAt(0).toUpperCase() + status.slice(1);

                        const stats = [];
                        if (host.disk_percent != null) {
                            stats.push(`Disk ${host.disk_percent.toFixed(0)}%`);
                        }
                        if (host.gpu_memory_percent != null) {
                            stats.push(`GPU ${host.gpu_memory_percent.toFixed(0)}%`);
                        }
                        if (host.services?.checkpoints != null) {
                            stats.push(`${host.services.checkpoints} ckpts`);
                        }
                        statsText = stats.join(' Â· ');
                    }
                }

                if (loc.service) {
                    status = 'online';
                    statusText = `Port ${loc.port}`;
                    onlineCount++;
                }

                const statusClass = status === 'healthy' ? 'online' : status;

                html += `
                    <div class="location-card ${statusClass}">
                        <span class="location-icon">${loc.icon}</span>
                        <div class="location-info">
                            <div class="location-name">${loc.name}</div>
                            <div class="location-status ${statusClass}">
                                <span class="status-dot"></span>
                                ${statusText}
                            </div>
                            ${statsText ? `<div class="location-stats">${statsText}</div>` : ''}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
            document.getElementById('locationsBadge').textContent = `${onlineCount} online`;
        }

        // Render alerts
        function renderAlerts(alerts) {
            const container = document.getElementById('alerts-container');
            if (!alerts || alerts.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = `
                <div class="alerts-section">
                    <div class="alerts-header">
                        <div class="alerts-title">
                            <span>âš ï¸</span> Active Alerts
                            <span class="alert-count">${alerts.length}</span>
                        </div>
                    </div>
            `;

            for (const alert of alerts) {
                html += `
                    <div class="alert-item">
                        <span class="alert-icon">âš ï¸</span>
                        ${alert}
                    </div>
                `;
            }

            html += '</div>';
            container.innerHTML = html;
        }

        // Render zones
        function renderZones(zones) {
            const section = document.getElementById('zones-section');
            const container = document.getElementById('zones-grid');

            if (!zones || Object.keys(zones).length === 0) {
                section.style.display = 'none';
                return;
            }

            let hasData = false;
            let html = '';

            const zoneIcons = { hot: 'ğŸ”¥', warm: 'ğŸŒ¡ï¸', cold: 'ğŸ§Š' };

            for (const [zoneName, stats] of Object.entries(zones)) {
                if (stats.total_gb > 0) {
                    hasData = true;
                    html += `
                        <div class="zone-card ${zoneName}">
                            <div class="zone-header">
                                <div>
                                    <div class="zone-name">${zoneName} Zone</div>
                                </div>
                                <span class="zone-icon">${zoneIcons[zoneName] || 'ğŸ“¦'}</span>
                            </div>
                            <div class="zone-percent">${stats.percent.toFixed(1)}%</div>
                            <div class="zone-detail">${stats.used_gb.toFixed(0)} GB / ${stats.total_gb.toFixed(0)} GB</div>
                            <div class="zone-bar">
                                <div class="zone-bar-fill" style="width: ${stats.percent}%"></div>
                            </div>
                            <div class="zone-devices">${stats.devices.length} device(s)</div>
                        </div>
                    `;
                }
            }

            if (hasData) {
                container.innerHTML = html;
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        // Render host card
        function renderHost(hostId, host) {
            const status = host.status || 'unknown';
            const name = host.name || hostId;
            const roleClass = getRoleClass(host);
            const hostIcon = getHostIcon(host);

            let html = `
                <div class="host-card ${roleClass}">
                    <div class="host-header">
                        <div class="host-identity">
                            <div class="host-icon">${hostIcon}</div>
                            <div>
                                <div class="host-name">${name}</div>
                                <div class="host-ip">${host.host}</div>
            `;

            // Role badges
            if (host.roles && host.roles.length > 0) {
                html += '<div class="host-roles">';
                for (const role of host.roles.slice(0, 4)) {
                    html += `<span class="role-badge ${role}">${role.replace('_', ' ')}</span>`;
                }
                if (host.roles.length > 4) {
                    html += `<span class="role-badge">+${host.roles.length - 4}</span>`;
                }
                html += '</div>';
            }

            html += `
                            </div>
                        </div>
                        <span class="host-status-badge ${status}">${status.toUpperCase()}</span>
                    </div>
                    <div class="host-body">
                        <div class="metrics-grid">
            `;

            // Disk metric
            if (host.disk_percent !== null && host.disk_percent !== undefined) {
                const diskClass = getProgressClass(host.disk_percent);
                html += `
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">Disk Usage</span>
                            <span class="metric-icon">ğŸ’¾</span>
                        </div>
                        <div class="metric-value ${diskClass}">${host.disk_percent.toFixed(0)}%</div>
                        <div class="metric-detail">${host.disk_free_gb?.toFixed(0) || '?'}GB free of ${host.disk_total_gb?.toFixed(0) || '?'}GB</div>
                        <div class="metric-bar">
                            <div class="metric-bar-fill ${diskClass}" style="width: ${host.disk_percent}%"></div>
                        </div>
                    </div>
                `;
            }

            // RAM metric
            if (host.ram_percent !== null && host.ram_percent !== undefined) {
                const ramClass = getProgressClass(host.ram_percent);
                html += `
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">Memory</span>
                            <span class="metric-icon">ğŸ§ </span>
                        </div>
                        <div class="metric-value ${ramClass}">${host.ram_percent.toFixed(0)}%</div>
                        <div class="metric-detail">${host.ram_used_gb?.toFixed(0) || '?'}GB / ${host.ram_total_gb?.toFixed(0) || '?'}GB</div>
                        <div class="metric-bar">
                            <div class="metric-bar-fill ${ramClass}" style="width: ${host.ram_percent}%"></div>
                        </div>
                    </div>
                `;
            }

            // Load Average
            if (host.load_avg_1m !== null && host.load_avg_1m !== undefined) {
                const cores = host.cpu_cores || 1;
                const loadPercent = Math.min((host.load_avg_1m / cores) * 100, 100);
                const loadClass = loadPercent >= 100 ? 'critical' : loadPercent >= 80 ? 'warning' : 'good';
                html += `
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">CPU Load</span>
                            <span class="metric-icon">âš¡</span>
                        </div>
                        <div class="metric-value ${loadClass}">${host.load_avg_1m.toFixed(2)}</div>
                        <div class="metric-detail">${host.load_avg_5m?.toFixed(2) || '?'} / ${host.load_avg_15m?.toFixed(2) || '?'}${host.cpu_cores ? ' (' + host.cpu_cores + ' cores)' : ''}</div>
                        <div class="metric-bar">
                            <div class="metric-bar-fill ${loadClass}" style="width: ${loadPercent}%"></div>
                        </div>
                    </div>
                `;
            }

            // GPU Memory
            if (host.gpu_memory_percent !== null && host.gpu_memory_percent !== undefined) {
                const gpuClass = getProgressClass(host.gpu_memory_percent);
                let gpuDetail = `${formatBytes(host.gpu_memory_used_mb || 0)} / ${formatBytes(host.gpu_memory_total_mb || 0)}`;
                if (host.gpu_utilization !== null && host.gpu_utilization !== undefined) {
                    gpuDetail += ` (${host.gpu_utilization.toFixed(0)}% util)`;
                }
                html += `
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">GPU Memory</span>
                            <span class="metric-icon">ğŸ®</span>
                        </div>
                        <div class="metric-value ${gpuClass}">${host.gpu_memory_percent.toFixed(0)}%</div>
                        <div class="metric-detail">${gpuDetail}</div>
                        <div class="metric-bar">
                            <div class="metric-bar-fill ${gpuClass}" style="width: ${host.gpu_memory_percent}%"></div>
                        </div>
                    </div>
                `;
            }

            // GPU Temp
            if (host.gpu_temp_c !== null && host.gpu_temp_c !== undefined) {
                const tempClass = host.gpu_temp_c >= 80 ? 'critical' : host.gpu_temp_c >= 70 ? 'warning' : 'good';
                let tempDetail = host.gpu_name || 'GPU';
                if (host.gpu_power_watts) {
                    tempDetail += ` (${host.gpu_power_watts.toFixed(0)}W)`;
                }
                html += `
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">GPU Temp</span>
                            <span class="metric-icon">ğŸŒ¡ï¸</span>
                        </div>
                        <div class="metric-value ${tempClass}">${host.gpu_temp_c.toFixed(0)}Â°C</div>
                        <div class="metric-detail">${tempDetail}</div>
                    </div>
                `;
            }

            html += '</div>'; // Close metrics-grid

            // Volumes (for NAS)
            if (host.volumes && host.volumes.length > 0) {
                html += `
                    <div class="volumes-section">
                        <div class="volumes-title">ğŸ“‚ Volumes</div>
                `;
                for (const vol of host.volumes) {
                    const volClass = getProgressClass(vol.percent);
                    html += `
                        <div class="volume-item">
                            <span class="volume-path">${vol.path}</span>
                            <span class="volume-stats ${volClass}">${vol.percent.toFixed(0)}% (${vol.free_gb.toFixed(0)}GB free)</span>
                        </div>
                        <div class="metric-bar" style="margin-bottom: 8px;">
                            <div class="metric-bar-fill ${volClass}" style="width: ${vol.percent}%"></div>
                        </div>
                    `;
                }
                html += '</div>';
            }

            // RAID status
            if (host.raid_status) {
                const raidClass = host.raid_status === 'HEALTHY' ? 'healthy' : 'degraded';
                html += `
                    <div class="raid-badge ${raidClass}">
                        <span>${raidClass === 'healthy' ? 'âœ“' : 'âš ï¸'}</span>
                        RAID: ${host.raid_status}
                    </div>
                `;
            }

            // Services
            const services = host.services || {};
            const serviceKeys = Object.keys(services).filter(k => k !== 'name' && k !== 'checkpoints');
            if (serviceKeys.length > 0 || services.checkpoints !== undefined) {
                html += `
                    <div class="services-section">
                        <div class="services-title">ğŸ”Œ Services</div>
                        <div class="services-list">
                `;

                for (const key of serviceKeys) {
                    const value = services[key];
                    const badgeClass = value === 'up' ? 'up' : value === 'down' ? 'down' : 'error';
                    html += `
                        <span class="service-badge ${badgeClass}">
                            <span class="service-dot"></span>
                            ${key}
                        </span>
                    `;
                }

                if (services.checkpoints !== undefined) {
                    html += `
                        <span class="service-badge up">
                            <span class="service-dot"></span>
                            ${services.checkpoints} checkpoints
                        </span>
                    `;
                }

                html += '</div></div>';
            }

            // Issues
            if (host.issues && host.issues.length > 0) {
                html += '<div class="issues-section">';
                for (const issue of host.issues) {
                    html += `<div class="issue-item"><span>âš ï¸</span> ${issue}</div>`;
                }
                html += '</div>';
            }

            // Uptime
            if (host.uptime) {
                html += `<div class="uptime"><span>â±ï¸</span> Uptime: ${host.uptime}</div>`;
            }

            html += '</div></div>'; // Close host-body and host-card
            return html;
        }

        // Main render function
        function renderStatus(data) {
            statusData = data;

            // Update header stats
            const hostCount = Object.keys(data.hosts || {}).length;
            document.getElementById('hostCount').textContent = hostCount;
            document.getElementById('hostsBadge').textContent = `${hostCount} hosts`;

            const status = data.overall_status || 'unknown';
            const statusIcons = { healthy: 'ğŸŸ¢', warning: 'ğŸŸ¡', critical: 'ğŸ”´', unknown: 'âšª', offline: 'âš«' };
            document.getElementById('statusIcon').textContent = statusIcons[status] || 'âšª';
            document.getElementById('statusText').textContent = status.toUpperCase();

            // Render components
            renderFleetBanner(data);
            renderAlerts(data.alerts);
            renderLocations(data.hosts || {});
            renderZones(data.zones);

            // Render hosts (sorted by priority)
            const container = document.getElementById('hosts-container');
            const sortedHosts = Object.entries(data.hosts || {}).sort(([, a], [, b]) => {
                const priority = (host) => {
                    const roles = host.roles || [];
                    if (roles.includes('trainer') || roles.includes('control_plane')) return 0;
                    if (roles.includes('inference')) return 1;
                    if (roles.includes('storage_warm') || roles.includes('storage_cold')) return 2;
                    return 3;
                };
                return priority(a) - priority(b);
            });

            let html = '';
            for (const [hostId, host] of sortedHosts) {
                html += renderHost(hostId, host);
            }
            container.innerHTML = html || '<p style="text-align: center; color: #888;">No hosts found</p>';

            // Update timestamp
            const lastUpdated = document.getElementById('last-updated');
            if (lastUpdated) {
                let timeText = `Last updated: ${new Date(data.timestamp).toLocaleString()}`;
                if (data._cached) {
                    const ageMin = Math.floor(data._cache_age_seconds / 60);
                    const ageSec = Math.floor(data._cache_age_seconds % 60);
                    timeText += ` <span class="cache-badge cached">cached ${ageMin}m ${ageSec}s ago</span>`;
                } else {
                    timeText += ' <span class="cache-badge live">live</span>';
                }
                lastUpdated.innerHTML = timeText;
            }
        }

        async function refreshStatus(forceFresh = false) {
            const container = document.getElementById('hosts-container');
            const scanBtn = document.getElementById('scanBtn');
            const scanAction = document.getElementById('scanAction');

            try {
                // Show scanning state
                if (forceFresh) {
                    if (scanBtn) scanBtn.classList.add('scanning');
                    if (scanAction) scanAction.classList.add('scanning');
                }

                container.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p class="loading-text">${forceFresh ? 'Scanning fleet...' : 'Refreshing...'}</p>
                    </div>
                `;

                const url = forceFresh ? '/api/garrison?fresh=true' : '/api/garrison';
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                renderStatus(data);
            } catch (error) {
                console.error('Failed to fetch status:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #f44336;">
                        <p style="font-size: 2rem; margin-bottom: 16px;">âš ï¸</p>
                        <p>Failed to connect to fleet</p>
                        <p style="color: #888; font-size: 0.9rem; margin-top: 8px;">${error.message}</p>
                    </div>
                `;
            } finally {
                if (scanBtn) scanBtn.classList.remove('scanning');
                if (scanAction) scanAction.classList.remove('scanning');
            }
        }

        async function runMaintenance() {
            if (!confirm('Run maintenance tasks on all hosts?\n\nThis will:\nâ€¢ Clean up old checkpoints\nâ€¢ Remove stale log files\nâ€¢ Clear orphaned PIDs')) {
                return;
            }

            try {
                const response = await fetch('/api/garrison/maintenance');
                const data = await response.json();

                if (data.success) {
                    const actions = data.actions.length > 0
                        ? data.actions.join('\nâ€¢ ')
                        : 'No maintenance needed';
                    alert('âœ… Maintenance complete:\n\nâ€¢ ' + actions);
                    refreshStatus(true);
                } else {
                    alert('âŒ Maintenance failed:\n\n' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                alert('âŒ Failed to run maintenance:\n\n' + error.message);
            }
        }

        // Initial load
        refreshStatus();

        // Auto-refresh every 30 seconds
        setInterval(refreshStatus, 30000);
    </script>
</body>
</html>
